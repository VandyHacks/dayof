{"id":"QgPE","dependencies":[{"name":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\package.json","includedInParent":true,"mtime":1540882116534},{"name":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\.babelrc","includedInParent":true,"mtime":1540875229523},{"name":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\node_modules\\twilio\\package.json","includedInParent":true,"mtime":1539064513231},{"name":"crypto","loc":{"line":3,"column":21},"parent":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\node_modules\\twilio\\lib\\webhooks\\webhooks.js","resolved":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\node_modules\\crypto-browserify\\index.js"},{"name":"lodash","loc":{"line":4,"column":16},"parent":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\node_modules\\twilio\\lib\\webhooks\\webhooks.js","resolved":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\node_modules\\lodash\\lodash.js"},{"name":"scmp","loc":{"line":5,"column":19},"parent":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\node_modules\\twilio\\lib\\webhooks\\webhooks.js","resolved":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\node_modules\\scmp\\index.js"},{"name":"url","loc":{"line":6,"column":18},"parent":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\node_modules\\twilio\\lib\\webhooks\\webhooks.js","resolved":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\node_modules\\url\\url.js"},{"name":"buffer","parent":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\node_modules\\twilio\\lib\\webhooks\\webhooks.js","resolved":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\node_modules\\buffer\\index.js"}],"generated":{"js":"var Buffer = require(\"buffer\").Buffer;\nvar e=require(\"buffer\").Buffer,t=require(\"crypto\"),r=require(\"lodash\"),o=require(\"scmp\"),i=require(\"url\");function a(r,i,a,l){return Object.keys(l).sort().forEach(function(e){a=a+e+l[e]}),o(i,t.createHmac(\"sha1\",r).update(new e(a,\"utf-8\")).digest(\"Base64\"))}function l(e,t,r){var o,l=r||{};if(l.url)o=l.url;else{var n=l.protocol||e.protocol,u=l.host||e.headers.host;o=i.format({protocol:n,host:u,pathname:e.originalUrl}),e.originalUrl.search(/\\?/)>=0&&(o=o.replace(\"%3F\",\"?\"))}return a(t,e.header(\"X-Twilio-Signature\"),o,e.body||{})}function n(){for(var e,t={validate:!0,includeHelpers:!0},o=0,i=arguments.length;o<i;o++){var a=arguments[o];\"string\"==typeof a?e=a:t=r.extend(t,a)}return t.authToken=e||void 0,function(e,r,o){if(t.includeHelpers){var i=r.send;r.send=function(){1===arguments.length&&arguments[0].legalNodes?(r.type(\"text/xml\"),i.call(r,arguments[0].toString())):i.apply(r,arguments)}}if(t.validate)if(t.authToken){if(!l(e,t.authToken,{url:t.url,host:t.host,protocol:t.protocol}))return r.type(\"text/plain\").status(403).send(\"Twilio Request Validation Failed.\");o()}else console.error(\"[Twilio]: Error - Twilio auth token is required for webhook request validation.\"),r.type(\"text/plain\").status(500).send(\"Webhook Error - we attempted to validate this request without first configuring our auth token.\");else o()}}module.exports={validateRequest:a,validateExpressRequest:l,webhook:n};","map":{"mappings":[{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":165,"column":0},"generated":{"line":2,"column":0}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":165,"column":0},"generated":{"line":2,"column":4}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":165,"column":0},"generated":{"line":2,"column":6}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":165,"column":0},"generated":{"line":2,"column":14}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":165,"column":0},"generated":{"line":2,"column":24}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"crypto","original":{"line":3,"column":4},"generated":{"line":2,"column":31}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"require","original":{"line":3,"column":13},"generated":{"line":2,"column":33}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":3,"column":21},"generated":{"line":2,"column":41}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"_","original":{"line":4,"column":4},"generated":{"line":2,"column":51}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"require","original":{"line":4,"column":8},"generated":{"line":2,"column":53}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":4,"column":16},"generated":{"line":2,"column":61}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"scmp","original":{"line":5,"column":4},"generated":{"line":2,"column":71}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"require","original":{"line":5,"column":11},"generated":{"line":2,"column":73}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":5,"column":19},"generated":{"line":2,"column":81}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"url","original":{"line":6,"column":4},"generated":{"line":2,"column":89}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"require","original":{"line":6,"column":10},"generated":{"line":2,"column":91}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":6,"column":18},"generated":{"line":2,"column":99}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":16,"column":0},"generated":{"line":2,"column":106}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"validateRequest","original":{"line":16,"column":9},"generated":{"line":2,"column":115}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"authToken","original":{"line":16,"column":25},"generated":{"line":2,"column":117}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"twilioHeader","original":{"line":16,"column":36},"generated":{"line":2,"column":119}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"url","original":{"line":16,"column":50},"generated":{"line":2,"column":121}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"params","original":{"line":16,"column":55},"generated":{"line":2,"column":123}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"scmp","original":{"line":21,"column":9},"generated":{"line":2,"column":126}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"Object","original":{"line":17,"column":2},"generated":{"line":2,"column":133}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"keys","original":{"line":17,"column":9},"generated":{"line":2,"column":140}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"params","original":{"line":17,"column":14},"generated":{"line":2,"column":145}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"sort","original":{"line":17,"column":22},"generated":{"line":2,"column":148}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"forEach","original":{"line":17,"column":29},"generated":{"line":2,"column":155}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":17,"column":37},"generated":{"line":2,"column":163}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"key","original":{"line":17,"column":46},"generated":{"line":2,"column":172}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"url","original":{"line":18,"column":6},"generated":{"line":2,"column":175}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"url","original":{"line":18,"column":12},"generated":{"line":2,"column":177}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"key","original":{"line":18,"column":18},"generated":{"line":2,"column":179}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"params","original":{"line":18,"column":24},"generated":{"line":2,"column":181}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"key","original":{"line":18,"column":31},"generated":{"line":2,"column":183}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"scmp","original":{"line":21,"column":9},"generated":{"line":2,"column":188}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"twilioHeader","original":{"line":21,"column":14},"generated":{"line":2,"column":190}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"crypto","original":{"line":21,"column":28},"generated":{"line":2,"column":192}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"createHmac","original":{"line":21,"column":35},"generated":{"line":2,"column":194}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":21,"column":46},"generated":{"line":2,"column":205}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"authToken","original":{"line":21,"column":54},"generated":{"line":2,"column":212}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"update","original":{"line":21,"column":65},"generated":{"line":2,"column":215}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":21,"column":72},"generated":{"line":2,"column":222}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"Buffer","original":{"line":21,"column":76},"generated":{"line":2,"column":226}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"url","original":{"line":21,"column":83},"generated":{"line":2,"column":228}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":21,"column":88},"generated":{"line":2,"column":230}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"digest","original":{"line":21,"column":98},"generated":{"line":2,"column":240}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":21,"column":105},"generated":{"line":2,"column":247}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":35,"column":0},"generated":{"line":2,"column":258}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"validateExpressRequest","original":{"line":35,"column":9},"generated":{"line":2,"column":267}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"request","original":{"line":35,"column":32},"generated":{"line":2,"column":269}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"authToken","original":{"line":35,"column":41},"generated":{"line":2,"column":271}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"opts","original":{"line":35,"column":52},"generated":{"line":2,"column":273}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"options","original":{"line":36,"column":6},"generated":{"line":2,"column":276}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"webhookUrl","original":{"line":37,"column":6},"generated":{"line":2,"column":280}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"options","original":{"line":36,"column":6},"generated":{"line":2,"column":282}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"opts","original":{"line":36,"column":16},"generated":{"line":2,"column":284}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":36,"column":24},"generated":{"line":2,"column":287}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"options","original":{"line":39,"column":6},"generated":{"line":2,"column":290}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"options","original":{"line":39,"column":6},"generated":{"line":2,"column":293}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"url","original":{"line":39,"column":14},"generated":{"line":2,"column":295}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"webhookUrl","original":{"line":41,"column":4},"generated":{"line":2,"column":299}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"options","original":{"line":41,"column":17},"generated":{"line":2,"column":301}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"url","original":{"line":41,"column":25},"generated":{"line":2,"column":303}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":42,"column":9},"generated":{"line":2,"column":311}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"protocol","original":{"line":44,"column":8},"generated":{"line":2,"column":312}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"protocol","original":{"line":44,"column":8},"generated":{"line":2,"column":316}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"options","original":{"line":44,"column":19},"generated":{"line":2,"column":318}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"protocol","original":{"line":44,"column":27},"generated":{"line":2,"column":320}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"request","original":{"line":44,"column":39},"generated":{"line":2,"column":330}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"protocol","original":{"line":44,"column":47},"generated":{"line":2,"column":332}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"host","original":{"line":45,"column":8},"generated":{"line":2,"column":341}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"options","original":{"line":45,"column":15},"generated":{"line":2,"column":343}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"host","original":{"line":45,"column":23},"generated":{"line":2,"column":345}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"request","original":{"line":45,"column":31},"generated":{"line":2,"column":351}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"headers","original":{"line":45,"column":39},"generated":{"line":2,"column":353}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"host","original":{"line":45,"column":47},"generated":{"line":2,"column":361}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"webhookUrl","original":{"line":47,"column":4},"generated":{"line":2,"column":366}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"url","original":{"line":47,"column":17},"generated":{"line":2,"column":368}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"format","original":{"line":47,"column":21},"generated":{"line":2,"column":370}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":47,"column":28},"generated":{"line":2,"column":377}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"protocol","original":{"line":48,"column":8},"generated":{"line":2,"column":378}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"protocol","original":{"line":48,"column":18},"generated":{"line":2,"column":387}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"host","original":{"line":49,"column":8},"generated":{"line":2,"column":389}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"host","original":{"line":49,"column":14},"generated":{"line":2,"column":394}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"pathname","original":{"line":50,"column":8},"generated":{"line":2,"column":396}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"request","original":{"line":50,"column":18},"generated":{"line":2,"column":405}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"originalUrl","original":{"line":50,"column":26},"generated":{"line":2,"column":407}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"request","original":{"line":52,"column":8},"generated":{"line":2,"column":421}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"originalUrl","original":{"line":52,"column":16},"generated":{"line":2,"column":423}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"search","original":{"line":52,"column":28},"generated":{"line":2,"column":435}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":52,"column":35},"generated":{"line":2,"column":442}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":52,"column":44},"generated":{"line":2,"column":449}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"webhookUrl","original":{"line":53,"column":6},"generated":{"line":2,"column":453}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"webhookUrl","original":{"line":53,"column":19},"generated":{"line":2,"column":455}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"replace","original":{"line":53,"column":30},"generated":{"line":2,"column":457}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":53,"column":38},"generated":{"line":2,"column":465}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":53,"column":44},"generated":{"line":2,"column":471}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"validateRequest","original":{"line":57,"column":9},"generated":{"line":2,"column":477}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"validateRequest","original":{"line":57,"column":9},"generated":{"line":2,"column":484}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"authToken","original":{"line":58,"column":4},"generated":{"line":2,"column":486}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"request","original":{"line":59,"column":4},"generated":{"line":2,"column":488}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"header","original":{"line":59,"column":12},"generated":{"line":2,"column":490}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":59,"column":19},"generated":{"line":2,"column":497}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"webhookUrl","original":{"line":60,"column":4},"generated":{"line":2,"column":519}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"request","original":{"line":61,"column":4},"generated":{"line":2,"column":521}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"body","original":{"line":61,"column":12},"generated":{"line":2,"column":523}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":61,"column":20},"generated":{"line":2,"column":529}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":95,"column":0},"generated":{"line":2,"column":533}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"webhook","original":{"line":95,"column":9},"generated":{"line":2,"column":542}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":103,"column":7},"generated":{"line":2,"column":546}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"opts","original":{"line":96,"column":6},"generated":{"line":2,"column":550}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"tokenString","original":{"line":102,"column":6},"generated":{"line":2,"column":554}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"opts","original":{"line":96,"column":6},"generated":{"line":2,"column":556}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":96,"column":13},"generated":{"line":2,"column":558}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"validate","original":{"line":97,"column":4},"generated":{"line":2,"column":559}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":97,"column":14},"generated":{"line":2,"column":569}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"includeHelpers","original":{"line":98,"column":4},"generated":{"line":2,"column":571}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":98,"column":20},"generated":{"line":2,"column":587}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"i","original":{"line":103,"column":11},"generated":{"line":2,"column":590}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":103,"column":15},"generated":{"line":2,"column":592}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"l","original":{"line":103,"column":18},"generated":{"line":2,"column":594}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"arguments","original":{"line":103,"column":22},"generated":{"line":2,"column":596}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"length","original":{"line":103,"column":32},"generated":{"line":2,"column":606}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"i","original":{"line":103,"column":40},"generated":{"line":2,"column":613}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"l","original":{"line":103,"column":44},"generated":{"line":2,"column":615}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"i","original":{"line":103,"column":47},"generated":{"line":2,"column":617}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":103,"column":52},"generated":{"line":2,"column":621}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"arg","original":{"line":104,"column":8},"generated":{"line":2,"column":622}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"arg","original":{"line":104,"column":8},"generated":{"line":2,"column":626}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"arguments","original":{"line":104,"column":14},"generated":{"line":2,"column":628}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"i","original":{"line":104,"column":24},"generated":{"line":2,"column":638}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":105,"column":23},"generated":{"line":2,"column":641}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"arg","original":{"line":105,"column":15},"generated":{"line":2,"column":658}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"tokenString","original":{"line":106,"column":6},"generated":{"line":2,"column":660}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"arg","original":{"line":106,"column":20},"generated":{"line":2,"column":662}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"opts","original":{"line":108,"column":6},"generated":{"line":2,"column":664}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"_","original":{"line":108,"column":13},"generated":{"line":2,"column":666}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"extend","original":{"line":108,"column":15},"generated":{"line":2,"column":668}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"opts","original":{"line":108,"column":22},"generated":{"line":2,"column":675}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"arg","original":{"line":108,"column":28},"generated":{"line":2,"column":677}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":116,"column":9},"generated":{"line":2,"column":680}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"opts","original":{"line":113,"column":2},"generated":{"line":2,"column":687}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"authToken","original":{"line":113,"column":7},"generated":{"line":2,"column":689}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"tokenString","original":{"line":113,"column":19},"generated":{"line":2,"column":699}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":113,"column":2},"generated":{"line":2,"column":707}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":116,"column":9},"generated":{"line":2,"column":709}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"request","original":{"line":116,"column":23},"generated":{"line":2,"column":718}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"response","original":{"line":116,"column":32},"generated":{"line":2,"column":720}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"next","original":{"line":116,"column":42},"generated":{"line":2,"column":722}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"opts","original":{"line":118,"column":8},"generated":{"line":2,"column":725}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"opts","original":{"line":118,"column":8},"generated":{"line":2,"column":728}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"includeHelpers","original":{"line":118,"column":13},"generated":{"line":2,"column":730}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":118,"column":29},"generated":{"line":2,"column":745}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"oldSend","original":{"line":119,"column":10},"generated":{"line":2,"column":746}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"oldSend","original":{"line":119,"column":10},"generated":{"line":2,"column":750}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"response","original":{"line":119,"column":20},"generated":{"line":2,"column":752}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"send","original":{"line":119,"column":29},"generated":{"line":2,"column":754}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"response","original":{"line":120,"column":6},"generated":{"line":2,"column":759}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"send","original":{"line":120,"column":15},"generated":{"line":2,"column":761}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":120,"column":22},"generated":{"line":2,"column":766}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":124,"column":33},"generated":{"line":2,"column":777}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"arguments","original":{"line":124,"column":12},"generated":{"line":2,"column":781}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"length","original":{"line":124,"column":22},"generated":{"line":2,"column":791}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"arguments","original":{"line":124,"column":38},"generated":{"line":2,"column":799}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":124,"column":48},"generated":{"line":2,"column":809}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"legalNodes","original":{"line":124,"column":51},"generated":{"line":2,"column":812}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"response","original":{"line":125,"column":10},"generated":{"line":2,"column":824}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"type","original":{"line":125,"column":19},"generated":{"line":2,"column":826}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":125,"column":24},"generated":{"line":2,"column":831}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"oldSend","original":{"line":126,"column":10},"generated":{"line":2,"column":843}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"call","original":{"line":126,"column":18},"generated":{"line":2,"column":845}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"response","original":{"line":126,"column":23},"generated":{"line":2,"column":850}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"arguments","original":{"line":126,"column":33},"generated":{"line":2,"column":852}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":126,"column":43},"generated":{"line":2,"column":862}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"toString","original":{"line":126,"column":46},"generated":{"line":2,"column":865}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"oldSend","original":{"line":129,"column":10},"generated":{"line":2,"column":878}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"apply","original":{"line":129,"column":18},"generated":{"line":2,"column":880}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"response","original":{"line":129,"column":24},"generated":{"line":2,"column":886}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"arguments","original":{"line":129,"column":34},"generated":{"line":2,"column":888}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"opts","original":{"line":135,"column":8},"generated":{"line":2,"column":900}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"opts","original":{"line":135,"column":8},"generated":{"line":2,"column":903}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"validate","original":{"line":135,"column":13},"generated":{"line":2,"column":905}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":137,"column":10},"generated":{"line":2,"column":914}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"opts","original":{"line":137,"column":11},"generated":{"line":2,"column":917}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"authToken","original":{"line":137,"column":16},"generated":{"line":2,"column":919}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":142,"column":13},"generated":{"line":2,"column":929}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"valid","original":{"line":150,"column":12},"generated":{"line":2,"column":930}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"validateExpressRequest","original":{"line":144,"column":20},"generated":{"line":2,"column":934}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"request","original":{"line":144,"column":43},"generated":{"line":2,"column":936}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"opts","original":{"line":144,"column":52},"generated":{"line":2,"column":938}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"authToken","original":{"line":144,"column":57},"generated":{"line":2,"column":940}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":144,"column":68},"generated":{"line":2,"column":950}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"url","original":{"line":145,"column":10},"generated":{"line":2,"column":951}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"opts","original":{"line":145,"column":15},"generated":{"line":2,"column":955}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"url","original":{"line":145,"column":20},"generated":{"line":2,"column":957}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"host","original":{"line":146,"column":10},"generated":{"line":2,"column":961}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"opts","original":{"line":146,"column":16},"generated":{"line":2,"column":966}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"host","original":{"line":146,"column":21},"generated":{"line":2,"column":968}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"protocol","original":{"line":147,"column":10},"generated":{"line":2,"column":973}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"opts","original":{"line":147,"column":20},"generated":{"line":2,"column":982}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"protocol","original":{"line":147,"column":25},"generated":{"line":2,"column":984}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"response","original":{"line":153,"column":17},"generated":{"line":2,"column":995}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"response","original":{"line":153,"column":17},"generated":{"line":2,"column":1002}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"type","original":{"line":154,"column":13},"generated":{"line":2,"column":1004}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":154,"column":18},"generated":{"line":2,"column":1009}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"status","original":{"line":155,"column":13},"generated":{"line":2,"column":1023}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":155,"column":20},"generated":{"line":2,"column":1030}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"send","original":{"line":156,"column":13},"generated":{"line":2,"column":1035}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":156,"column":18},"generated":{"line":2,"column":1040}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"next","original":{"line":151,"column":12},"generated":{"line":2,"column":1077}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"console","original":{"line":138,"column":8},"generated":{"line":2,"column":1086}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"error","original":{"line":138,"column":16},"generated":{"line":2,"column":1094}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":138,"column":22},"generated":{"line":2,"column":1100}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"response","original":{"line":139,"column":8},"generated":{"line":2,"column":1183}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"type","original":{"line":139,"column":17},"generated":{"line":2,"column":1185}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":139,"column":22},"generated":{"line":2,"column":1190}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"status","original":{"line":140,"column":11},"generated":{"line":2,"column":1204}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":140,"column":18},"generated":{"line":2,"column":1211}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"send","original":{"line":141,"column":11},"generated":{"line":2,"column":1216}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":141,"column":16},"generated":{"line":2,"column":1221}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"next","original":{"line":160,"column":6},"generated":{"line":2,"column":1325}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"module","original":{"line":165,"column":0},"generated":{"line":2,"column":1330}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"exports","original":{"line":165,"column":7},"generated":{"line":2,"column":1337}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","original":{"line":165,"column":17},"generated":{"line":2,"column":1345}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"validateRequest","original":{"line":166,"column":2},"generated":{"line":2,"column":1346}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"validateRequest","original":{"line":166,"column":19},"generated":{"line":2,"column":1362}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"validateExpressRequest","original":{"line":167,"column":2},"generated":{"line":2,"column":1364}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"validateExpressRequest","original":{"line":167,"column":26},"generated":{"line":2,"column":1387}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"webhook","original":{"line":168,"column":2},"generated":{"line":2,"column":1389}},{"source":"node_modules/twilio/lib/webhooks/webhooks.js","name":"webhook","original":{"line":168,"column":11},"generated":{"line":2,"column":1397}}],"sources":{"node_modules/twilio/lib/webhooks/webhooks.js":"'use strict';\n\nvar crypto = require('crypto');\nvar _ = require('lodash');\nvar scmp = require('scmp');\nvar url = require('url');\n\n/**\n Utility function to validate an incoming request is indeed from Twilio\n\n @param {string} authToken - The auth token, as seen in the Twilio portal\n @param {string} twilioHeader - The value of the X-Twilio-Signature header from the request\n @param {string} url - The full URL (with query string) you configured to handle this request\n @param {object} params - the parameters sent with this request\n */\nfunction validateRequest(authToken, twilioHeader, url, params) {\n  Object.keys(params).sort().forEach(function(key) {\n      url = url + key + params[key];\n  });\n\n  return scmp(twilioHeader, crypto.createHmac('sha1', authToken).update(new Buffer(url, 'utf-8')).digest('Base64'));\n}\n\n/**\n Utility function to validate an incoming request is indeed from Twilio (for use with express).\n adapted from https://github.com/crabasa/twiliosig\n\n @param {object} request - An expressjs request object (http://expressjs.com/api.html#req.params)\n @param {string} authToken - The auth token, as seen in the Twilio portal\n @param {object} opts - options for request validation:\n    - url: The full URL (with query string) you used to configure the webhook with Twilio - overrides host/protocol options\n    - host: manually specify the host name used by Twilio in a number's webhook config\n    - protocol: manually specify the protocol used by Twilio in a number's webhook config\n */\nfunction validateExpressRequest(request, authToken, opts) {\n  var options = opts || {};\n  var webhookUrl;\n\n  if (options.url) {\n    // Let the user specify the full URL\n    webhookUrl = options.url;\n  } else {\n    // Use configured host/protocol, or infer based on request\n    var protocol = options.protocol || request.protocol;\n    var host = options.host || request.headers.host;\n\n    webhookUrl = url.format({\n        protocol: protocol,\n        host: host,\n        pathname: request.originalUrl\n    });\n    if (request.originalUrl.search(/\\?/) >= 0) {\n      webhookUrl = webhookUrl.replace(\"%3F\",\"?\");\n    }\n  }\n\n  return validateRequest(\n    authToken,\n    request.header('X-Twilio-Signature'),\n    webhookUrl,\n    request.body || {}\n  );\n}\n\n/**\nExpress middleware to accompany a Twilio webhook. Provides Twilio\nrequest validation, and makes the response a little more friendly for our\nTwiML generator.  Request validation requires the express.urlencoded middleware\nto have been applied (e.g. app.use(express.urlencoded()); in your app config).\n\nOptions:\n- validate: {Boolean} whether or not the middleware should validate the request\n    came from Twilio.  Default true. If the request does not originate from\n    Twilio, we will return a text body and a 403.  If there is no configured\n    auth token and validate=true, this is an error condition, so we will return\n    a 500.\n- includeHelpers: {Boolean} add helpers to the response object to improve support\n    for XML (TwiML) rendering.  Default true.\n- host: manually specify the host name used by Twilio in a number's webhook config\n- protocol: manually specify the protocol used by Twilio in a number's webhook config\n\nReturns a middleware function.\n\nExamples:\nvar webhookMiddleware = twilio.webhook();\nvar webhookMiddleware = twilio.webhook('asdha9dhjasd'); //init with auth token\nvar webhookMiddleware = twilio.webhook({\n    validate:false // don't attempt request validation\n});\nvar webhookMiddleware = twilio.webhook({\n    host: 'hook.twilio.com',\n    protocol: 'https'\n});\n */\nfunction webhook() {\n  var opts = {\n    validate: true,\n    includeHelpers: true\n  };\n\n  // Process arguments\n  var tokenString;\n  for (var i = 0, l = arguments.length; i < l; i++) {\n    var arg = arguments[i];\n    if (typeof arg === 'string') {\n      tokenString = arg;\n    } else {\n      opts = _.extend(opts, arg);\n    }\n  }\n\n  // set auth token from input or environment variable\n  opts.authToken = tokenString ? tokenString : process.env.TWILIO_AUTH_TOKEN;\n\n  // Create middleware function\n  return function hook(request, response, next) {\n    // Add helpers, unless disabled\n    if (opts.includeHelpers) {\n      var oldSend = response.send;\n      response.send = function() {\n        // This is a special TwiML-aware version of send.  If we detect\n        // A twiml response object, we'll set the content-type and\n        // automatically call .toString()\n        if (arguments.length === 1 && arguments[0].legalNodes) {\n          response.type('text/xml');\n          oldSend.call(response, arguments[0].toString());\n        } else {\n          // Continue with old version of send\n          oldSend.apply(response, arguments);\n        }\n      };\n    }\n\n    // Do validation if requested\n    if (opts.validate) {\n      // Check for a valid auth token\n      if (!opts.authToken) {\n        console.error('[Twilio]: Error - Twilio auth token is required for webhook request validation.');\n        response.type('text/plain')\n          .status(500)\n          .send('Webhook Error - we attempted to validate this request without first configuring our auth token.');\n      } else {\n        // Check that the request originated from Twilio\n        var valid = validateExpressRequest(request, opts.authToken, {\n          url: opts.url,\n          host: opts.host,\n          protocol: opts.protocol\n        });\n\n        if (valid) {\n            next();\n        } else {\n          return response\n            .type('text/plain')\n            .status(403)\n            .send('Twilio Request Validation Failed.');\n        }\n      }\n    } else {\n      next();\n    }\n  };\n}\n\nmodule.exports = {\n  validateRequest: validateRequest,\n  validateExpressRequest: validateExpressRequest,\n  webhook: webhook\n};\n"},"lineCount":null}},"hash":"2d05d1dd424d1375d9da8cc2141e356c","cacheData":{"env":{}}}