{"id":"Focm","dependencies":[{"name":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\.babelrc","includedInParent":true,"mtime":1540875229523},{"name":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\package.json","includedInParent":true,"mtime":1540882116534},{"name":"express","loc":{"line":1,"column":24},"parent":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\index.js","resolved":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\node_modules\\express\\index.js"},{"name":"helmet","loc":{"line":2,"column":23},"parent":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\index.js","resolved":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\node_modules\\helmet\\index.js"},{"name":"mongoose","loc":{"line":3,"column":25},"parent":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\index.js","resolved":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\node_modules\\mongoose\\browser.js"},{"name":"body-parser","loc":{"line":4,"column":23},"parent":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\index.js","resolved":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\node_modules\\body-parser\\index.js"},{"name":"cors","loc":{"line":5,"column":21},"parent":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\index.js","resolved":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\node_modules\\cors\\lib\\index.js"},{"name":"twilio","loc":{"line":6,"column":23},"parent":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\index.js","resolved":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\node_modules\\twilio\\lib\\index.js"},{"name":"needle","loc":{"line":7,"column":23},"parent":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\index.js","resolved":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\node_modules\\needle\\lib\\needle.js"},{"name":"web-push","loc":{"line":8,"column":24},"parent":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\index.js","resolved":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\node_modules\\web-push\\src\\index.js"},{"name":"ws","loc":{"line":9,"column":26},"parent":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\index.js","resolved":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\node_modules\\ws\\browser.js"},{"name":"file-system","loc":{"line":10,"column":19},"parent":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\index.js","resolved":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\node_modules\\file-system\\file-system.js"},{"name":"./schemas/schemas","loc":{"line":13,"column":20},"parent":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\index.js","resolved":"C:\\Users\\kzhai\\VandyHacks\\vandyhacksnotifications\\schemas\\schemas.js"}],"generated":{"js":"var __dirname = \"C:\\\\Users\\\\kzhai\\\\VandyHacks\\\\vandyhacksnotifications\";\nvar global = arguments[3];\nvar e=\"C:\\\\Users\\\\kzhai\\\\VandyHacks\\\\vandyhacksnotifications\",o=arguments[3],n=require(\"express\"),t=require(\"helmet\"),s=require(\"mongoose\"),i=require(\"body-parser\"),a=require(\"cors\"),c=require(\"twilio\")(void 0,void 0),r=require(\"needle\"),l=require(\"web-push\"),d=require(\"ws\"),u=require(\"file-system\"),f=require(\"./schemas/schemas\").pushSchema,g=require(\"./schemas/schemas\").hackerSchema,m=require(\"./schemas/schemas\").msgSchema,h=void 0,p=5e3,v=void 0,b=void 0,y=600,k=n();k.use(i.urlencoded({extended:!0})),k.use(i.json()),k.use(t()),k.use(n.static(e)),k.use(a()),l.setGCMAPIKey(void 0),l.setVapidDetails(\"mailto:dev@vandyhacks.org\",v,b),s.connect(h,{useNewUrlParser:!0}),s.Promise=o.Promise;var S=s.connection;S.on(\"error\",console.error.bind(console,\"connection error:\")),S.once(\"open\",function(){console.log(\"Database open\")});var w=[],P={msgs:[]},q=S.model(\"Hacker\",g),C=S.model(\"PushSubscription\",f),D=S.model(\"Message\",m);function x(e){q.find({},function(e,o){if(e)throw e;o.forEach(function(e){var o=e.phone;o=o.replace(/-/g,\"\"),w.includes(o)||w.push(o)})}),e()}function A(){setTimeout(function(){x(A)},3e4)}x(A);var N,j=k.get(\"/\",function(o,n){n.sendFile(\"\".concat(e,\"/dayof.html\")),console.log(\"Live notifications page loaded\")}).listen(p);function F(){this.isAlive=!0}var H=!1,O=new d.Server({server:j});function E(e,o){return!(!e.body||!e.body.endpoint)||(o.status(400),console.log(\"Subscription must have endpoint\"),!1)}function J(e){return C.countDocuments({endpoint:e.endpoint,key:e.key})}O.on(\"connection\",function(e){console.log(\"Client connected\");var o=e;N=e,o.isAlive=!0,o.ping(\"pingdata\"),o.on(\"pong\",F);var n=setInterval(function(){1===o.readyState&&o.isAlive?o.ping(\"pingdata\"):(clearInterval(n),o.terminate())},5e3);e.on(\"close\",function(){o.isAlive=!1,console.log(\"Client disconnected\")})}),k.get(\"/login\",function(o,n){n.sendFile(\"\".concat(e,\"/auth.html\")),console.log(\"Login page loaded\")}),k.get(\"/admin\",function(o,n){H?(n.sendFile(\"\".concat(e,\"/admin.html\")),console.log(\"Admin page loaded\")):n.redirect(\"/login\")}),k.post(\"/login\",function(e,o){void 0===e.body.password?(H=!0,o.redirect(\"/admin\"),console.log(\"Logged in\")):o.redirect(\"/login\")}),setTimeout(function(){H&&(H=!1)},3e5),k.post(\"/admin\",function(e,o){var n=new Promise(function(o,n){w.map(function(o){return c.messages.create({to:o,from:void 0,body:\"VandyHacks: \".concat(e.body.msg)})}),o()});Promise.all([n]).then(console.log(\"Message sent\"),o.redirect(\"back\")).catch(function(e){console.log(e),o.redirect(\"back\")})}),k.post(\"/savesub\",function(e,o){if(E(e,o)){var n=new C(e.body);J(n).then(function(e){0===e?(console.log(\"Saving subscription to database\"),n.save().then(function(){o.setHeader(\"Content-type\",\"application/json\"),o.sendStatus(201),console.log(\"Push subscription saved\")}).catch(function(e){console.log(\"Unable to save push subscription\",e)})):(console.log(\"Subscription already exists in database\"),o.sendStatus(201))})}}),k.post(\"/sendpush\",function(e,o){console.log(e.body);var n=JSON.stringify({title:\"VandyHacks: \".concat(e.body.header),body:e.body.value}),t={TTL:y};console.log(n);var s=new Promise(function(e,o){C.find({},function(e,s){e&&o(e),s.forEach(function(e){console.log(\"Data: \",e),l.sendNotification(e,n,t)})}),e()}),i=new Promise(function(o,n){r.post(\"https://vandyhacks-slackbot.herokuapp.com/api/announcements/loudspeaker\",{msg:\"\".concat(e.body.header,\": \").concat(e.body.value)},{json:!0},function(e,t){e||200!=t.statusCode?n(\"Did not manage to post announcement to slack\"):o()})});Promise.all([s,i]).then(console.log(\"Push notification sent\"),O.clients.forEach(function(e){e.send(\"reload\")}),o.sendStatus(201)).catch(function(e){console.log(e.stack)});var a=new Date;new D({header:e.body.header,msg:e.body.value,time:a}).save().catch(function(e){console.log(\"Unable to save message to database: \",e)}),u.readFile(\"pastnotifs.json\",\"utf8\",function(o,n){if(o)console.log(o);else{(P=JSON.parse(n)).msgs.push({heading:e.body.header,text:e.body.value,time:a});var t=JSON.stringify(P);u.writeFile(\"pastnotifs.json\",t,\"utf8\")}})}),k.post(\"/updatemsg\",function(e,o){var n=new Promise(function(e,o){D.findOne().sort({field:\"asc\",_id:-1}).exec(function(e,n){var t=[];t.push(n),e&&o(e),console.log(\"Connecting to client\"),O.clients.forEach(function(e){e===N&&(e.send(JSON.stringify(t)),console.log(\"Data sent to client\"))})}),e()});Promise.all([n]).then(o.sendStatus(201)).catch(function(e){console.log(e)})}),module.exports=k;","map":{"mappings":[{"source":"index.js","original":{"line":287,"column":0},"generated":{"line":3,"column":0}},{"source":"index.js","original":{"line":287,"column":0},"generated":{"line":3,"column":4}},{"source":"index.js","original":{"line":287,"column":0},"generated":{"line":3,"column":6}},{"source":"index.js","original":{"line":287,"column":0},"generated":{"line":3,"column":62}},{"source":"index.js","original":{"line":287,"column":0},"generated":{"line":3,"column":64}},{"source":"index.js","original":{"line":287,"column":0},"generated":{"line":3,"column":74}},{"source":"index.js","name":"express","original":{"line":1,"column":6},"generated":{"line":3,"column":77}},{"source":"index.js","name":"require","original":{"line":1,"column":16},"generated":{"line":3,"column":79}},{"source":"index.js","original":{"line":1,"column":24},"generated":{"line":3,"column":87}},{"source":"index.js","name":"helmet","original":{"line":2,"column":6},"generated":{"line":3,"column":98}},{"source":"index.js","name":"require","original":{"line":2,"column":15},"generated":{"line":3,"column":100}},{"source":"index.js","original":{"line":2,"column":23},"generated":{"line":3,"column":108}},{"source":"index.js","name":"mongoose","original":{"line":3,"column":6},"generated":{"line":3,"column":118}},{"source":"index.js","name":"require","original":{"line":3,"column":17},"generated":{"line":3,"column":120}},{"source":"index.js","original":{"line":3,"column":25},"generated":{"line":3,"column":128}},{"source":"index.js","name":"parser","original":{"line":4,"column":6},"generated":{"line":3,"column":140}},{"source":"index.js","name":"require","original":{"line":4,"column":15},"generated":{"line":3,"column":142}},{"source":"index.js","original":{"line":4,"column":23},"generated":{"line":3,"column":150}},{"source":"index.js","name":"cors","original":{"line":5,"column":6},"generated":{"line":3,"column":165}},{"source":"index.js","name":"require","original":{"line":5,"column":13},"generated":{"line":3,"column":167}},{"source":"index.js","original":{"line":5,"column":21},"generated":{"line":3,"column":175}},{"source":"index.js","name":"twilio","original":{"line":6,"column":6},"generated":{"line":3,"column":183}},{"source":"index.js","name":"require","original":{"line":6,"column":15},"generated":{"line":3,"column":185}},{"source":"index.js","original":{"line":6,"column":23},"generated":{"line":3,"column":193}},{"source":"index.js","name":"require","original":{"line":6,"column":15},"generated":{"line":3,"column":202}},{"source":"index.js","original":{"line":6,"column":0},"generated":{"line":3,"column":208}},{"source":"index.js","original":{"line":6,"column":0},"generated":{"line":3,"column":215}},{"source":"index.js","name":"needle","original":{"line":7,"column":6},"generated":{"line":3,"column":218}},{"source":"index.js","name":"require","original":{"line":7,"column":15},"generated":{"line":3,"column":220}},{"source":"index.js","original":{"line":7,"column":23},"generated":{"line":3,"column":228}},{"source":"index.js","name":"webpush","original":{"line":8,"column":6},"generated":{"line":3,"column":238}},{"source":"index.js","name":"require","original":{"line":8,"column":16},"generated":{"line":3,"column":240}},{"source":"index.js","original":{"line":8,"column":24},"generated":{"line":3,"column":248}},{"source":"index.js","name":"WebSocket","original":{"line":9,"column":6},"generated":{"line":3,"column":260}},{"source":"index.js","name":"require","original":{"line":9,"column":18},"generated":{"line":3,"column":262}},{"source":"index.js","original":{"line":9,"column":26},"generated":{"line":3,"column":270}},{"source":"index.js","name":"fs","original":{"line":10,"column":6},"generated":{"line":3,"column":276}},{"source":"index.js","name":"require","original":{"line":10,"column":11},"generated":{"line":3,"column":278}},{"source":"index.js","original":{"line":10,"column":19},"generated":{"line":3,"column":286}},{"source":"index.js","name":"Push","original":{"line":11,"column":6},"generated":{"line":3,"column":301}},{"source":"index.js","name":"require","original":{"line":11,"column":13},"generated":{"line":3,"column":303}},{"source":"index.js","original":{"line":11,"column":21},"generated":{"line":3,"column":311}},{"source":"index.js","name":"pushSchema","original":{"line":11,"column":42},"generated":{"line":3,"column":332}},{"source":"index.js","name":"Hack","original":{"line":12,"column":6},"generated":{"line":3,"column":343}},{"source":"index.js","name":"require","original":{"line":12,"column":13},"generated":{"line":3,"column":345}},{"source":"index.js","original":{"line":12,"column":21},"generated":{"line":3,"column":353}},{"source":"index.js","name":"hackerSchema","original":{"line":12,"column":42},"generated":{"line":3,"column":374}},{"source":"index.js","name":"Msg","original":{"line":13,"column":6},"generated":{"line":3,"column":387}},{"source":"index.js","name":"require","original":{"line":13,"column":12},"generated":{"line":3,"column":389}},{"source":"index.js","original":{"line":13,"column":20},"generated":{"line":3,"column":397}},{"source":"index.js","name":"msgSchema","original":{"line":13,"column":41},"generated":{"line":3,"column":418}},{"source":"index.js","name":"uri","original":{"line":15,"column":6},"generated":{"line":3,"column":428}},{"source":"index.js","original":{"line":15,"column":0},"generated":{"line":3,"column":435}},{"source":"index.js","name":"PORT","original":{"line":16,"column":6},"generated":{"line":3,"column":437}},{"source":"index.js","original":{"line":16,"column":33},"generated":{"line":3,"column":439}},{"source":"index.js","name":"publicVapidKey","original":{"line":17,"column":6},"generated":{"line":3,"column":443}},{"source":"index.js","original":{"line":17,"column":0},"generated":{"line":3,"column":450}},{"source":"index.js","name":"privateVapidKey","original":{"line":18,"column":6},"generated":{"line":3,"column":452}},{"source":"index.js","original":{"line":18,"column":0},"generated":{"line":3,"column":459}},{"source":"index.js","name":"ttl","original":{"line":19,"column":6},"generated":{"line":3,"column":461}},{"source":"index.js","original":{"line":19,"column":12},"generated":{"line":3,"column":463}},{"source":"index.js","name":"app","original":{"line":20,"column":6},"generated":{"line":3,"column":467}},{"source":"index.js","name":"express","original":{"line":20,"column":12},"generated":{"line":3,"column":469}},{"source":"index.js","name":"app","original":{"line":22,"column":0},"generated":{"line":3,"column":473}},{"source":"index.js","name":"use","original":{"line":22,"column":4},"generated":{"line":3,"column":475}},{"source":"index.js","name":"parser","original":{"line":22,"column":8},"generated":{"line":3,"column":479}},{"source":"index.js","name":"urlencoded","original":{"line":22,"column":15},"generated":{"line":3,"column":481}},{"source":"index.js","original":{"line":22,"column":26},"generated":{"line":3,"column":492}},{"source":"index.js","name":"extended","original":{"line":22,"column":28},"generated":{"line":3,"column":493}},{"source":"index.js","original":{"line":22,"column":38},"generated":{"line":3,"column":503}},{"source":"index.js","name":"app","original":{"line":23,"column":0},"generated":{"line":3,"column":508}},{"source":"index.js","name":"use","original":{"line":23,"column":4},"generated":{"line":3,"column":510}},{"source":"index.js","name":"parser","original":{"line":23,"column":8},"generated":{"line":3,"column":514}},{"source":"index.js","name":"json","original":{"line":23,"column":15},"generated":{"line":3,"column":516}},{"source":"index.js","name":"app","original":{"line":25,"column":0},"generated":{"line":3,"column":524}},{"source":"index.js","name":"use","original":{"line":25,"column":4},"generated":{"line":3,"column":526}},{"source":"index.js","name":"helmet","original":{"line":25,"column":8},"generated":{"line":3,"column":530}},{"source":"index.js","name":"app","original":{"line":26,"column":0},"generated":{"line":3,"column":535}},{"source":"index.js","name":"use","original":{"line":26,"column":4},"generated":{"line":3,"column":537}},{"source":"index.js","name":"express","original":{"line":26,"column":8},"generated":{"line":3,"column":541}},{"source":"index.js","name":"static","original":{"line":26,"column":16},"generated":{"line":3,"column":543}},{"source":"index.js","name":"__dirname","original":{"line":26,"column":23},"generated":{"line":3,"column":550}},{"source":"index.js","name":"app","original":{"line":28,"column":0},"generated":{"line":3,"column":554}},{"source":"index.js","name":"use","original":{"line":28,"column":4},"generated":{"line":3,"column":556}},{"source":"index.js","name":"cors","original":{"line":28,"column":8},"generated":{"line":3,"column":560}},{"source":"index.js","name":"webpush","original":{"line":30,"column":0},"generated":{"line":3,"column":565}},{"source":"index.js","name":"setGCMAPIKey","original":{"line":30,"column":8},"generated":{"line":3,"column":567}},{"source":"index.js","original":{"line":30,"column":0},"generated":{"line":3,"column":585}},{"source":"index.js","name":"webpush","original":{"line":31,"column":0},"generated":{"line":3,"column":588}},{"source":"index.js","name":"setVapidDetails","original":{"line":31,"column":8},"generated":{"line":3,"column":590}},{"source":"index.js","original":{"line":32,"column":2},"generated":{"line":3,"column":606}},{"source":"index.js","name":"publicVapidKey","original":{"line":33,"column":2},"generated":{"line":3,"column":634}},{"source":"index.js","name":"privateVapidKey","original":{"line":34,"column":2},"generated":{"line":3,"column":636}},{"source":"index.js","name":"mongoose","original":{"line":37,"column":0},"generated":{"line":3,"column":639}},{"source":"index.js","name":"connect","original":{"line":37,"column":9},"generated":{"line":3,"column":641}},{"source":"index.js","name":"uri","original":{"line":37,"column":17},"generated":{"line":3,"column":649}},{"source":"index.js","original":{"line":37,"column":22},"generated":{"line":3,"column":651}},{"source":"index.js","name":"useNewUrlParser","original":{"line":37,"column":24},"generated":{"line":3,"column":652}},{"source":"index.js","original":{"line":37,"column":41},"generated":{"line":3,"column":669}},{"source":"index.js","name":"mongoose","original":{"line":38,"column":0},"generated":{"line":3,"column":673}},{"source":"index.js","name":"Promise","original":{"line":38,"column":9},"generated":{"line":3,"column":675}},{"source":"index.js","name":"global","original":{"line":38,"column":19},"generated":{"line":3,"column":683}},{"source":"index.js","name":"Promise","original":{"line":38,"column":26},"generated":{"line":3,"column":685}},{"source":"index.js","original":{"line":40,"column":0},"generated":{"line":3,"column":693}},{"source":"index.js","name":"db","original":{"line":40,"column":6},"generated":{"line":3,"column":697}},{"source":"index.js","name":"mongoose","original":{"line":40,"column":11},"generated":{"line":3,"column":699}},{"source":"index.js","name":"connection","original":{"line":40,"column":20},"generated":{"line":3,"column":701}},{"source":"index.js","name":"db","original":{"line":42,"column":0},"generated":{"line":3,"column":712}},{"source":"index.js","name":"on","original":{"line":42,"column":3},"generated":{"line":3,"column":714}},{"source":"index.js","original":{"line":42,"column":6},"generated":{"line":3,"column":717}},{"source":"index.js","name":"console","original":{"line":42,"column":15},"generated":{"line":3,"column":725}},{"source":"index.js","name":"error","original":{"line":42,"column":23},"generated":{"line":3,"column":733}},{"source":"index.js","name":"bind","original":{"line":42,"column":29},"generated":{"line":3,"column":739}},{"source":"index.js","name":"console","original":{"line":42,"column":34},"generated":{"line":3,"column":744}},{"source":"index.js","original":{"line":42,"column":43},"generated":{"line":3,"column":752}},{"source":"index.js","name":"db","original":{"line":43,"column":0},"generated":{"line":3,"column":774}},{"source":"index.js","name":"once","original":{"line":43,"column":3},"generated":{"line":3,"column":776}},{"source":"index.js","original":{"line":43,"column":8},"generated":{"line":3,"column":781}},{"source":"index.js","original":{"line":43,"column":16},"generated":{"line":3,"column":788}},{"source":"index.js","name":"console","original":{"line":44,"column":2},"generated":{"line":3,"column":799}},{"source":"index.js","name":"log","original":{"line":44,"column":10},"generated":{"line":3,"column":807}},{"source":"index.js","original":{"line":44,"column":14},"generated":{"line":3,"column":811}},{"source":"index.js","original":{"line":47,"column":0},"generated":{"line":3,"column":830}},{"source":"index.js","name":"phoneArr","original":{"line":47,"column":6},"generated":{"line":3,"column":834}},{"source":"index.js","original":{"line":47,"column":17},"generated":{"line":3,"column":836}},{"source":"index.js","name":"jsontable","original":{"line":48,"column":4},"generated":{"line":3,"column":839}},{"source":"index.js","original":{"line":48,"column":16},"generated":{"line":3,"column":841}},{"source":"index.js","name":"msgs","original":{"line":49,"column":2},"generated":{"line":3,"column":842}},{"source":"index.js","original":{"line":49,"column":8},"generated":{"line":3,"column":847}},{"source":"index.js","name":"Hacker","original":{"line":52,"column":6},"generated":{"line":3,"column":851}},{"source":"index.js","name":"db","original":{"line":52,"column":15},"generated":{"line":3,"column":853}},{"source":"index.js","name":"model","original":{"line":52,"column":18},"generated":{"line":3,"column":855}},{"source":"index.js","original":{"line":52,"column":24},"generated":{"line":3,"column":861}},{"source":"index.js","name":"Hack","original":{"line":52,"column":34},"generated":{"line":3,"column":870}},{"source":"index.js","name":"PushSub","original":{"line":53,"column":6},"generated":{"line":3,"column":873}},{"source":"index.js","name":"db","original":{"line":53,"column":16},"generated":{"line":3,"column":875}},{"source":"index.js","name":"model","original":{"line":53,"column":19},"generated":{"line":3,"column":877}},{"source":"index.js","original":{"line":53,"column":25},"generated":{"line":3,"column":883}},{"source":"index.js","name":"Push","original":{"line":53,"column":45},"generated":{"line":3,"column":902}},{"source":"index.js","name":"Message","original":{"line":54,"column":6},"generated":{"line":3,"column":905}},{"source":"index.js","name":"db","original":{"line":54,"column":16},"generated":{"line":3,"column":907}},{"source":"index.js","name":"model","original":{"line":54,"column":19},"generated":{"line":3,"column":909}},{"source":"index.js","original":{"line":54,"column":25},"generated":{"line":3,"column":915}},{"source":"index.js","name":"Msg","original":{"line":54,"column":36},"generated":{"line":3,"column":925}},{"source":"index.js","original":{"line":56,"column":0},"generated":{"line":3,"column":928}},{"source":"index.js","name":"dbquery","original":{"line":56,"column":9},"generated":{"line":3,"column":937}},{"source":"index.js","name":"callback","original":{"line":56,"column":17},"generated":{"line":3,"column":939}},{"source":"index.js","name":"Hacker","original":{"line":57,"column":2},"generated":{"line":3,"column":942}},{"source":"index.js","name":"find","original":{"line":57,"column":9},"generated":{"line":3,"column":944}},{"source":"index.js","original":{"line":57,"column":14},"generated":{"line":3,"column":949}},{"source":"index.js","original":{"line":57,"column":18},"generated":{"line":3,"column":952}},{"source":"index.js","name":"err","original":{"line":57,"column":19},"generated":{"line":3,"column":961}},{"source":"index.js","name":"data","original":{"line":57,"column":24},"generated":{"line":3,"column":963}},{"source":"index.js","name":"err","original":{"line":58,"column":8},"generated":{"line":3,"column":966}},{"source":"index.js","name":"err","original":{"line":58,"column":8},"generated":{"line":3,"column":969}},{"source":"index.js","original":{"line":58,"column":13},"generated":{"line":3,"column":971}},{"source":"index.js","name":"err","original":{"line":58,"column":19},"generated":{"line":3,"column":977}},{"source":"index.js","name":"data","original":{"line":59,"column":4},"generated":{"line":3,"column":979}},{"source":"index.js","name":"forEach","original":{"line":59,"column":9},"generated":{"line":3,"column":981}},{"source":"index.js","original":{"line":59,"column":17},"generated":{"line":3,"column":989}},{"source":"index.js","name":"element","original":{"line":59,"column":18},"generated":{"line":3,"column":998}},{"source":"index.js","name":"num","original":{"line":60,"column":10},"generated":{"line":3,"column":1001}},{"source":"index.js","name":"num","original":{"line":60,"column":10},"generated":{"line":3,"column":1005}},{"source":"index.js","name":"element","original":{"line":60,"column":16},"generated":{"line":3,"column":1007}},{"source":"index.js","name":"phone","original":{"line":60,"column":24},"generated":{"line":3,"column":1009}},{"source":"index.js","name":"num","original":{"line":61,"column":6},"generated":{"line":3,"column":1015}},{"source":"index.js","name":"num","original":{"line":61,"column":12},"generated":{"line":3,"column":1017}},{"source":"index.js","name":"replace","original":{"line":61,"column":16},"generated":{"line":3,"column":1019}},{"source":"index.js","original":{"line":61,"column":24},"generated":{"line":3,"column":1027}},{"source":"index.js","original":{"line":61,"column":30},"generated":{"line":3,"column":1032}},{"source":"index.js","name":"phoneArr","original":{"line":62,"column":11},"generated":{"line":3,"column":1036}},{"source":"index.js","name":"includes","original":{"line":62,"column":20},"generated":{"line":3,"column":1038}},{"source":"index.js","name":"num","original":{"line":62,"column":29},"generated":{"line":3,"column":1047}},{"source":"index.js","name":"phoneArr","original":{"line":63,"column":8},"generated":{"line":3,"column":1051}},{"source":"index.js","name":"push","original":{"line":63,"column":17},"generated":{"line":3,"column":1053}},{"source":"index.js","name":"num","original":{"line":63,"column":22},"generated":{"line":3,"column":1058}},{"source":"index.js","name":"callback","original":{"line":67,"column":2},"generated":{"line":3,"column":1065}},{"source":"index.js","original":{"line":70,"column":0},"generated":{"line":3,"column":1069}},{"source":"index.js","name":"wait","original":{"line":70,"column":9},"generated":{"line":3,"column":1078}},{"source":"index.js","name":"setTimeout","original":{"line":71,"column":2},"generated":{"line":3,"column":1082}},{"source":"index.js","original":{"line":71,"column":13},"generated":{"line":3,"column":1093}},{"source":"index.js","name":"dbquery","original":{"line":72,"column":4},"generated":{"line":3,"column":1104}},{"source":"index.js","name":"wait","original":{"line":72,"column":12},"generated":{"line":3,"column":1106}},{"source":"index.js","original":{"line":73,"column":5},"generated":{"line":3,"column":1110}},{"source":"index.js","name":"dbquery","original":{"line":76,"column":0},"generated":{"line":3,"column":1115}},{"source":"index.js","name":"wait","original":{"line":76,"column":8},"generated":{"line":3,"column":1117}},{"source":"index.js","original":{"line":78,"column":0},"generated":{"line":3,"column":1120}},{"source":"index.js","name":"connect","original":{"line":88,"column":4},"generated":{"line":3,"column":1124}},{"source":"index.js","name":"server","original":{"line":78,"column":6},"generated":{"line":3,"column":1126}},{"source":"index.js","name":"app","original":{"line":78,"column":15},"generated":{"line":3,"column":1128}},{"source":"index.js","name":"get","original":{"line":78,"column":19},"generated":{"line":3,"column":1130}},{"source":"index.js","original":{"line":78,"column":23},"generated":{"line":3,"column":1134}},{"source":"index.js","original":{"line":78,"column":28},"generated":{"line":3,"column":1138}},{"source":"index.js","name":"req","original":{"line":78,"column":29},"generated":{"line":3,"column":1147}},{"source":"index.js","name":"res","original":{"line":78,"column":34},"generated":{"line":3,"column":1149}},{"source":"index.js","name":"res","original":{"line":79,"column":2},"generated":{"line":3,"column":1152}},{"source":"index.js","name":"sendFile","original":{"line":79,"column":6},"generated":{"line":3,"column":1154}},{"source":"index.js","name":"__dirname","original":{"line":79,"column":18},"generated":{"line":3,"column":1163}},{"source":"index.js","name":"__dirname","original":{"line":79,"column":18},"generated":{"line":3,"column":1166}},{"source":"index.js","name":"__dirname","original":{"line":79,"column":18},"generated":{"line":3,"column":1173}},{"source":"index.js","original":{"line":79,"column":2},"generated":{"line":3,"column":1175}},{"source":"index.js","name":"console","original":{"line":80,"column":2},"generated":{"line":3,"column":1191}},{"source":"index.js","name":"log","original":{"line":80,"column":10},"generated":{"line":3,"column":1199}},{"source":"index.js","original":{"line":80,"column":14},"generated":{"line":3,"column":1203}},{"source":"index.js","name":"listen","original":{"line":82,"column":3},"generated":{"line":3,"column":1239}},{"source":"index.js","name":"PORT","original":{"line":82,"column":10},"generated":{"line":3,"column":1246}},{"source":"index.js","original":{"line":84,"column":0},"generated":{"line":3,"column":1249}},{"source":"index.js","name":"heartbeat","original":{"line":84,"column":9},"generated":{"line":3,"column":1258}},{"source":"index.js","name":"isAlive","original":{"line":85,"column":7},"generated":{"line":3,"column":1262}},{"source":"index.js","name":"isAlive","original":{"line":85,"column":7},"generated":{"line":3,"column":1267}},{"source":"index.js","original":{"line":85,"column":17},"generated":{"line":3,"column":1276}},{"source":"index.js","original":{"line":89,"column":0},"generated":{"line":3,"column":1278}},{"source":"index.js","name":"loggedin","original":{"line":89,"column":4},"generated":{"line":3,"column":1282}},{"source":"index.js","original":{"line":89,"column":15},"generated":{"line":3,"column":1285}},{"source":"index.js","name":"wss","original":{"line":91,"column":6},"generated":{"line":3,"column":1287}},{"source":"index.js","original":{"line":91,"column":12},"generated":{"line":3,"column":1289}},{"source":"index.js","name":"WebSocket","original":{"line":91,"column":16},"generated":{"line":3,"column":1293}},{"source":"index.js","name":"Server","original":{"line":91,"column":26},"generated":{"line":3,"column":1295}},{"source":"index.js","original":{"line":91,"column":33},"generated":{"line":3,"column":1302}},{"source":"index.js","name":"server","original":{"line":91,"column":35},"generated":{"line":3,"column":1303}},{"source":"index.js","name":"server","original":{"line":91,"column":35},"generated":{"line":3,"column":1310}},{"source":"index.js","original":{"line":163,"column":0},"generated":{"line":3,"column":1314}},{"source":"index.js","name":"isValidSaveRequest","original":{"line":163,"column":9},"generated":{"line":3,"column":1323}},{"source":"index.js","name":"req","original":{"line":163,"column":28},"generated":{"line":3,"column":1325}},{"source":"index.js","name":"res","original":{"line":163,"column":33},"generated":{"line":3,"column":1327}},{"source":"index.js","original":{"line":165,"column":6},"generated":{"line":3,"column":1330}},{"source":"index.js","name":"req","original":{"line":165,"column":7},"generated":{"line":3,"column":1339}},{"source":"index.js","name":"body","original":{"line":165,"column":11},"generated":{"line":3,"column":1341}},{"source":"index.js","name":"req","original":{"line":165,"column":20},"generated":{"line":3,"column":1348}},{"source":"index.js","name":"body","original":{"line":165,"column":24},"generated":{"line":3,"column":1350}},{"source":"index.js","name":"endpoint","original":{"line":165,"column":29},"generated":{"line":3,"column":1355}},{"source":"index.js","name":"res","original":{"line":167,"column":4},"generated":{"line":3,"column":1367}},{"source":"index.js","name":"status","original":{"line":167,"column":8},"generated":{"line":3,"column":1369}},{"source":"index.js","original":{"line":167,"column":15},"generated":{"line":3,"column":1376}},{"source":"index.js","name":"console","original":{"line":168,"column":4},"generated":{"line":3,"column":1381}},{"source":"index.js","name":"log","original":{"line":168,"column":12},"generated":{"line":3,"column":1389}},{"source":"index.js","original":{"line":168,"column":16},"generated":{"line":3,"column":1393}},{"source":"index.js","original":{"line":169,"column":11},"generated":{"line":3,"column":1429}},{"source":"index.js","original":{"line":174,"column":0},"generated":{"line":3,"column":1432}},{"source":"index.js","name":"exists","original":{"line":174,"column":9},"generated":{"line":3,"column":1441}},{"source":"index.js","name":"subscription","original":{"line":174,"column":16},"generated":{"line":3,"column":1443}},{"source":"index.js","name":"PushSub","original":{"line":175,"column":9},"generated":{"line":3,"column":1446}},{"source":"index.js","name":"PushSub","original":{"line":175,"column":9},"generated":{"line":3,"column":1453}},{"source":"index.js","name":"countDocuments","original":{"line":175,"column":17},"generated":{"line":3,"column":1455}},{"source":"index.js","original":{"line":175,"column":32},"generated":{"line":3,"column":1470}},{"source":"index.js","name":"endpoint","original":{"line":175,"column":34},"generated":{"line":3,"column":1471}},{"source":"index.js","name":"subscription","original":{"line":175,"column":44},"generated":{"line":3,"column":1480}},{"source":"index.js","name":"endpoint","original":{"line":175,"column":57},"generated":{"line":3,"column":1482}},{"source":"index.js","name":"key","original":{"line":175,"column":67},"generated":{"line":3,"column":1491}},{"source":"index.js","name":"subscription","original":{"line":175,"column":72},"generated":{"line":3,"column":1495}},{"source":"index.js","name":"key","original":{"line":175,"column":85},"generated":{"line":3,"column":1497}},{"source":"index.js","name":"wss","original":{"line":92,"column":0},"generated":{"line":3,"column":1503}},{"source":"index.js","name":"on","original":{"line":92,"column":4},"generated":{"line":3,"column":1505}},{"source":"index.js","original":{"line":92,"column":7},"generated":{"line":3,"column":1508}},{"source":"index.js","original":{"line":92,"column":21},"generated":{"line":3,"column":1521}},{"source":"index.js","name":"ws","original":{"line":92,"column":22},"generated":{"line":3,"column":1530}},{"source":"index.js","name":"console","original":{"line":93,"column":2},"generated":{"line":3,"column":1533}},{"source":"index.js","name":"log","original":{"line":93,"column":10},"generated":{"line":3,"column":1541}},{"source":"index.js","original":{"line":93,"column":14},"generated":{"line":3,"column":1545}},{"source":"index.js","name":"wscopy","original":{"line":94,"column":8},"generated":{"line":3,"column":1565}},{"source":"index.js","name":"wscopy","original":{"line":94,"column":8},"generated":{"line":3,"column":1569}},{"source":"index.js","name":"ws","original":{"line":94,"column":17},"generated":{"line":3,"column":1571}},{"source":"index.js","name":"connect","original":{"line":95,"column":2},"generated":{"line":3,"column":1573}},{"source":"index.js","name":"ws","original":{"line":95,"column":12},"generated":{"line":3,"column":1575}},{"source":"index.js","name":"wscopy","original":{"line":96,"column":2},"generated":{"line":3,"column":1577}},{"source":"index.js","name":"isAlive","original":{"line":96,"column":9},"generated":{"line":3,"column":1579}},{"source":"index.js","original":{"line":96,"column":19},"generated":{"line":3,"column":1588}},{"source":"index.js","name":"wscopy","original":{"line":97,"column":2},"generated":{"line":3,"column":1590}},{"source":"index.js","name":"ping","original":{"line":97,"column":9},"generated":{"line":3,"column":1592}},{"source":"index.js","original":{"line":97,"column":14},"generated":{"line":3,"column":1597}},{"source":"index.js","name":"wscopy","original":{"line":98,"column":2},"generated":{"line":3,"column":1609}},{"source":"index.js","name":"on","original":{"line":98,"column":9},"generated":{"line":3,"column":1611}},{"source":"index.js","original":{"line":98,"column":12},"generated":{"line":3,"column":1614}},{"source":"index.js","name":"heartbeat","original":{"line":98,"column":20},"generated":{"line":3,"column":1621}},{"source":"index.js","name":"keepAlive","original":{"line":99,"column":8},"generated":{"line":3,"column":1624}},{"source":"index.js","name":"keepAlive","original":{"line":99,"column":8},"generated":{"line":3,"column":1628}},{"source":"index.js","name":"setInterval","original":{"line":99,"column":20},"generated":{"line":3,"column":1630}},{"source":"index.js","original":{"line":99,"column":32},"generated":{"line":3,"column":1642}},{"source":"index.js","original":{"line":100,"column":30},"generated":{"line":3,"column":1653}},{"source":"index.js","name":"wscopy","original":{"line":100,"column":8},"generated":{"line":3,"column":1657}},{"source":"index.js","name":"readyState","original":{"line":100,"column":15},"generated":{"line":3,"column":1659}},{"source":"index.js","name":"wscopy","original":{"line":100,"column":36},"generated":{"line":3,"column":1671}},{"source":"index.js","name":"isAlive","original":{"line":100,"column":43},"generated":{"line":3,"column":1673}},{"source":"index.js","name":"wscopy","original":{"line":104,"column":6},"generated":{"line":3,"column":1681}},{"source":"index.js","name":"ping","original":{"line":104,"column":13},"generated":{"line":3,"column":1683}},{"source":"index.js","original":{"line":104,"column":18},"generated":{"line":3,"column":1688}},{"source":"index.js","name":"clearInterval","original":{"line":101,"column":6},"generated":{"line":3,"column":1701}},{"source":"index.js","name":"keepAlive","original":{"line":101,"column":20},"generated":{"line":3,"column":1715}},{"source":"index.js","name":"wscopy","original":{"line":102,"column":6},"generated":{"line":3,"column":1718}},{"source":"index.js","name":"terminate","original":{"line":102,"column":13},"generated":{"line":3,"column":1720}},{"source":"index.js","original":{"line":106,"column":5},"generated":{"line":3,"column":1734}},{"source":"index.js","name":"ws","original":{"line":107,"column":2},"generated":{"line":3,"column":1739}},{"source":"index.js","name":"on","original":{"line":107,"column":5},"generated":{"line":3,"column":1741}},{"source":"index.js","original":{"line":107,"column":8},"generated":{"line":3,"column":1744}},{"source":"index.js","original":{"line":107,"column":17},"generated":{"line":3,"column":1752}},{"source":"index.js","name":"wscopy","original":{"line":108,"column":4},"generated":{"line":3,"column":1763}},{"source":"index.js","name":"isAlive","original":{"line":108,"column":11},"generated":{"line":3,"column":1765}},{"source":"index.js","original":{"line":108,"column":21},"generated":{"line":3,"column":1774}},{"source":"index.js","name":"console","original":{"line":109,"column":4},"generated":{"line":3,"column":1776}},{"source":"index.js","name":"log","original":{"line":109,"column":12},"generated":{"line":3,"column":1784}},{"source":"index.js","original":{"line":109,"column":16},"generated":{"line":3,"column":1788}},{"source":"index.js","name":"app","original":{"line":113,"column":0},"generated":{"line":3,"column":1815}},{"source":"index.js","name":"get","original":{"line":113,"column":4},"generated":{"line":3,"column":1817}},{"source":"index.js","original":{"line":113,"column":8},"generated":{"line":3,"column":1821}},{"source":"index.js","original":{"line":113,"column":18},"generated":{"line":3,"column":1830}},{"source":"index.js","name":"req","original":{"line":113,"column":19},"generated":{"line":3,"column":1839}},{"source":"index.js","name":"res","original":{"line":113,"column":24},"generated":{"line":3,"column":1841}},{"source":"index.js","name":"res","original":{"line":114,"column":2},"generated":{"line":3,"column":1844}},{"source":"index.js","name":"sendFile","original":{"line":114,"column":6},"generated":{"line":3,"column":1846}},{"source":"index.js","name":"__dirname","original":{"line":114,"column":18},"generated":{"line":3,"column":1855}},{"source":"index.js","name":"__dirname","original":{"line":114,"column":18},"generated":{"line":3,"column":1858}},{"source":"index.js","name":"__dirname","original":{"line":114,"column":18},"generated":{"line":3,"column":1865}},{"source":"index.js","original":{"line":114,"column":2},"generated":{"line":3,"column":1867}},{"source":"index.js","name":"console","original":{"line":115,"column":2},"generated":{"line":3,"column":1882}},{"source":"index.js","name":"log","original":{"line":115,"column":10},"generated":{"line":3,"column":1890}},{"source":"index.js","original":{"line":115,"column":14},"generated":{"line":3,"column":1894}},{"source":"index.js","name":"app","original":{"line":118,"column":0},"generated":{"line":3,"column":1917}},{"source":"index.js","name":"get","original":{"line":118,"column":4},"generated":{"line":3,"column":1919}},{"source":"index.js","original":{"line":118,"column":8},"generated":{"line":3,"column":1923}},{"source":"index.js","original":{"line":118,"column":18},"generated":{"line":3,"column":1932}},{"source":"index.js","name":"req","original":{"line":118,"column":19},"generated":{"line":3,"column":1941}},{"source":"index.js","name":"res","original":{"line":118,"column":24},"generated":{"line":3,"column":1943}},{"source":"index.js","name":"loggedin","original":{"line":119,"column":7},"generated":{"line":3,"column":1946}},{"source":"index.js","name":"res","original":{"line":122,"column":4},"generated":{"line":3,"column":1949}},{"source":"index.js","name":"sendFile","original":{"line":122,"column":8},"generated":{"line":3,"column":1951}},{"source":"index.js","name":"__dirname","original":{"line":122,"column":20},"generated":{"line":3,"column":1960}},{"source":"index.js","name":"__dirname","original":{"line":122,"column":20},"generated":{"line":3,"column":1963}},{"source":"index.js","name":"__dirname","original":{"line":122,"column":20},"generated":{"line":3,"column":1970}},{"source":"index.js","original":{"line":122,"column":4},"generated":{"line":3,"column":1972}},{"source":"index.js","name":"console","original":{"line":123,"column":4},"generated":{"line":3,"column":1988}},{"source":"index.js","name":"log","original":{"line":123,"column":12},"generated":{"line":3,"column":1996}},{"source":"index.js","original":{"line":123,"column":16},"generated":{"line":3,"column":2000}},{"source":"index.js","name":"res","original":{"line":120,"column":4},"generated":{"line":3,"column":2022}},{"source":"index.js","name":"redirect","original":{"line":120,"column":8},"generated":{"line":3,"column":2024}},{"source":"index.js","original":{"line":120,"column":17},"generated":{"line":3,"column":2033}},{"source":"index.js","name":"app","original":{"line":127,"column":0},"generated":{"line":3,"column":2045}},{"source":"index.js","name":"post","original":{"line":127,"column":4},"generated":{"line":3,"column":2047}},{"source":"index.js","original":{"line":127,"column":9},"generated":{"line":3,"column":2052}},{"source":"index.js","original":{"line":127,"column":19},"generated":{"line":3,"column":2061}},{"source":"index.js","name":"req","original":{"line":127,"column":20},"generated":{"line":3,"column":2070}},{"source":"index.js","name":"res","original":{"line":127,"column":25},"generated":{"line":3,"column":2072}},{"source":"index.js","original":{"line":128,"column":2},"generated":{"line":3,"column":2080}},{"source":"index.js","name":"req","original":{"line":128,"column":6},"generated":{"line":3,"column":2084}},{"source":"index.js","name":"body","original":{"line":128,"column":10},"generated":{"line":3,"column":2086}},{"source":"index.js","name":"password","original":{"line":128,"column":15},"generated":{"line":3,"column":2091}},{"source":"index.js","name":"loggedin","original":{"line":129,"column":4},"generated":{"line":3,"column":2101}},{"source":"index.js","original":{"line":129,"column":15},"generated":{"line":3,"column":2104}},{"source":"index.js","name":"res","original":{"line":130,"column":4},"generated":{"line":3,"column":2106}},{"source":"index.js","name":"redirect","original":{"line":130,"column":8},"generated":{"line":3,"column":2108}},{"source":"index.js","original":{"line":130,"column":17},"generated":{"line":3,"column":2117}},{"source":"index.js","name":"console","original":{"line":131,"column":4},"generated":{"line":3,"column":2127}},{"source":"index.js","name":"log","original":{"line":131,"column":12},"generated":{"line":3,"column":2135}},{"source":"index.js","original":{"line":131,"column":16},"generated":{"line":3,"column":2139}},{"source":"index.js","name":"res","original":{"line":133,"column":4},"generated":{"line":3,"column":2153}},{"source":"index.js","name":"redirect","original":{"line":133,"column":8},"generated":{"line":3,"column":2155}},{"source":"index.js","original":{"line":133,"column":17},"generated":{"line":3,"column":2164}},{"source":"index.js","name":"setTimeout","original":{"line":137,"column":0},"generated":{"line":3,"column":2176}},{"source":"index.js","original":{"line":137,"column":11},"generated":{"line":3,"column":2187}},{"source":"index.js","name":"loggedin","original":{"line":138,"column":6},"generated":{"line":3,"column":2198}},{"source":"index.js","name":"loggedin","original":{"line":139,"column":4},"generated":{"line":3,"column":2202}},{"source":"index.js","original":{"line":139,"column":15},"generated":{"line":3,"column":2205}},{"source":"index.js","original":{"line":141,"column":3},"generated":{"line":3,"column":2209}},{"source":"index.js","name":"app","original":{"line":143,"column":0},"generated":{"line":3,"column":2214}},{"source":"index.js","name":"post","original":{"line":143,"column":4},"generated":{"line":3,"column":2216}},{"source":"index.js","original":{"line":143,"column":9},"generated":{"line":3,"column":2221}},{"source":"index.js","original":{"line":143,"column":19},"generated":{"line":3,"column":2230}},{"source":"index.js","name":"req","original":{"line":143,"column":20},"generated":{"line":3,"column":2239}},{"source":"index.js","name":"res","original":{"line":143,"column":25},"generated":{"line":3,"column":2241}},{"source":"index.js","name":"smsMsg","original":{"line":144,"column":8},"generated":{"line":3,"column":2244}},{"source":"index.js","name":"smsMsg","original":{"line":144,"column":8},"generated":{"line":3,"column":2248}},{"source":"index.js","original":{"line":144,"column":17},"generated":{"line":3,"column":2250}},{"source":"index.js","name":"Promise","original":{"line":144,"column":21},"generated":{"line":3,"column":2254}},{"source":"index.js","original":{"line":144,"column":29},"generated":{"line":3,"column":2262}},{"source":"index.js","name":"resolve","original":{"line":144,"column":30},"generated":{"line":3,"column":2271}},{"source":"index.js","name":"reject","original":{"line":144,"column":39},"generated":{"line":3,"column":2273}},{"source":"index.js","name":"phoneArr","original":{"line":145,"column":4},"generated":{"line":3,"column":2276}},{"source":"index.js","name":"map","original":{"line":145,"column":13},"generated":{"line":3,"column":2278}},{"source":"index.js","original":{"line":145,"column":17},"generated":{"line":3,"column":2282}},{"source":"index.js","name":"number","original":{"line":145,"column":17},"generated":{"line":3,"column":2291}},{"source":"index.js","name":"twilio","original":{"line":145,"column":27},"generated":{"line":3,"column":2294}},{"source":"index.js","name":"twilio","original":{"line":145,"column":27},"generated":{"line":3,"column":2301}},{"source":"index.js","name":"messages","original":{"line":145,"column":34},"generated":{"line":3,"column":2303}},{"source":"index.js","name":"create","original":{"line":145,"column":43},"generated":{"line":3,"column":2312}},{"source":"index.js","original":{"line":145,"column":50},"generated":{"line":3,"column":2319}},{"source":"index.js","name":"to","original":{"line":146,"column":6},"generated":{"line":3,"column":2320}},{"source":"index.js","name":"number","original":{"line":146,"column":10},"generated":{"line":3,"column":2323}},{"source":"index.js","name":"from","original":{"line":147,"column":6},"generated":{"line":3,"column":2325}},{"source":"index.js","original":{"line":145,"column":50},"generated":{"line":3,"column":2335}},{"source":"index.js","name":"body","original":{"line":148,"column":6},"generated":{"line":3,"column":2337}},{"source":"index.js","name":"req","original":{"line":148,"column":27},"generated":{"line":3,"column":2342}},{"source":"index.js","name":"req","original":{"line":148,"column":27},"generated":{"line":3,"column":2357}},{"source":"index.js","name":"req","original":{"line":148,"column":27},"generated":{"line":3,"column":2364}},{"source":"index.js","name":"body","original":{"line":148,"column":31},"generated":{"line":3,"column":2366}},{"source":"index.js","name":"msg","original":{"line":148,"column":36},"generated":{"line":3,"column":2371}},{"source":"index.js","name":"resolve","original":{"line":150,"column":4},"generated":{"line":3,"column":2380}},{"source":"index.js","name":"Promise","original":{"line":152,"column":2},"generated":{"line":3,"column":2386}},{"source":"index.js","name":"all","original":{"line":152,"column":10},"generated":{"line":3,"column":2394}},{"source":"index.js","original":{"line":152,"column":14},"generated":{"line":3,"column":2398}},{"source":"index.js","name":"smsMsg","original":{"line":152,"column":15},"generated":{"line":3,"column":2399}},{"source":"index.js","name":"then","original":{"line":153,"column":5},"generated":{"line":3,"column":2403}},{"source":"index.js","name":"console","original":{"line":154,"column":6},"generated":{"line":3,"column":2408}},{"source":"index.js","name":"log","original":{"line":154,"column":14},"generated":{"line":3,"column":2416}},{"source":"index.js","original":{"line":154,"column":18},"generated":{"line":3,"column":2420}},{"source":"index.js","name":"res","original":{"line":155,"column":6},"generated":{"line":3,"column":2436}},{"source":"index.js","name":"redirect","original":{"line":155,"column":10},"generated":{"line":3,"column":2438}},{"source":"index.js","original":{"line":155,"column":19},"generated":{"line":3,"column":2447}},{"source":"index.js","name":"catch","original":{"line":157,"column":5},"generated":{"line":3,"column":2456}},{"source":"index.js","original":{"line":157,"column":11},"generated":{"line":3,"column":2462}},{"source":"index.js","name":"err","original":{"line":157,"column":12},"generated":{"line":3,"column":2471}},{"source":"index.js","name":"console","original":{"line":158,"column":6},"generated":{"line":3,"column":2474}},{"source":"index.js","name":"log","original":{"line":158,"column":14},"generated":{"line":3,"column":2482}},{"source":"index.js","name":"err","original":{"line":158,"column":18},"generated":{"line":3,"column":2486}},{"source":"index.js","name":"res","original":{"line":159,"column":6},"generated":{"line":3,"column":2489}},{"source":"index.js","name":"redirect","original":{"line":159,"column":10},"generated":{"line":3,"column":2491}},{"source":"index.js","original":{"line":159,"column":19},"generated":{"line":3,"column":2500}},{"source":"index.js","name":"app","original":{"line":178,"column":0},"generated":{"line":3,"column":2512}},{"source":"index.js","name":"post","original":{"line":178,"column":4},"generated":{"line":3,"column":2514}},{"source":"index.js","original":{"line":178,"column":9},"generated":{"line":3,"column":2519}},{"source":"index.js","original":{"line":178,"column":21},"generated":{"line":3,"column":2530}},{"source":"index.js","name":"req","original":{"line":178,"column":22},"generated":{"line":3,"column":2539}},{"source":"index.js","name":"res","original":{"line":178,"column":27},"generated":{"line":3,"column":2541}},{"source":"index.js","name":"isValidSaveRequest","original":{"line":179,"column":6},"generated":{"line":3,"column":2544}},{"source":"index.js","name":"isValidSaveRequest","original":{"line":179,"column":6},"generated":{"line":3,"column":2547}},{"source":"index.js","name":"req","original":{"line":179,"column":25},"generated":{"line":3,"column":2549}},{"source":"index.js","name":"res","original":{"line":179,"column":30},"generated":{"line":3,"column":2551}},{"source":"index.js","original":{"line":179,"column":36},"generated":{"line":3,"column":2554}},{"source":"index.js","name":"push","original":{"line":180,"column":10},"generated":{"line":3,"column":2555}},{"source":"index.js","name":"push","original":{"line":180,"column":10},"generated":{"line":3,"column":2559}},{"source":"index.js","original":{"line":180,"column":17},"generated":{"line":3,"column":2561}},{"source":"index.js","name":"PushSub","original":{"line":180,"column":21},"generated":{"line":3,"column":2565}},{"source":"index.js","name":"req","original":{"line":180,"column":29},"generated":{"line":3,"column":2567}},{"source":"index.js","name":"body","original":{"line":180,"column":33},"generated":{"line":3,"column":2569}},{"source":"index.js","name":"exists","original":{"line":181,"column":4},"generated":{"line":3,"column":2575}},{"source":"index.js","name":"push","original":{"line":181,"column":11},"generated":{"line":3,"column":2577}},{"source":"index.js","name":"then","original":{"line":181,"column":17},"generated":{"line":3,"column":2580}},{"source":"index.js","original":{"line":181,"column":22},"generated":{"line":3,"column":2585}},{"source":"index.js","name":"count","original":{"line":181,"column":23},"generated":{"line":3,"column":2594}},{"source":"index.js","original":{"line":182,"column":20},"generated":{"line":3,"column":2597}},{"source":"index.js","name":"count","original":{"line":182,"column":10},"generated":{"line":3,"column":2601}},{"source":"index.js","name":"console","original":{"line":183,"column":8},"generated":{"line":3,"column":2604}},{"source":"index.js","name":"log","original":{"line":183,"column":16},"generated":{"line":3,"column":2612}},{"source":"index.js","original":{"line":183,"column":20},"generated":{"line":3,"column":2616}},{"source":"index.js","name":"push","original":{"line":184,"column":8},"generated":{"line":3,"column":2651}},{"source":"index.js","name":"save","original":{"line":184,"column":13},"generated":{"line":3,"column":2653}},{"source":"index.js","name":"then","original":{"line":185,"column":11},"generated":{"line":3,"column":2660}},{"source":"index.js","original":{"line":185,"column":16},"generated":{"line":3,"column":2665}},{"source":"index.js","name":"res","original":{"line":186,"column":12},"generated":{"line":3,"column":2676}},{"source":"index.js","name":"setHeader","original":{"line":186,"column":16},"generated":{"line":3,"column":2678}},{"source":"index.js","original":{"line":186,"column":26},"generated":{"line":3,"column":2688}},{"source":"index.js","original":{"line":186,"column":42},"generated":{"line":3,"column":2703}},{"source":"index.js","name":"res","original":{"line":187,"column":12},"generated":{"line":3,"column":2723}},{"source":"index.js","name":"sendStatus","original":{"line":187,"column":16},"generated":{"line":3,"column":2725}},{"source":"index.js","original":{"line":187,"column":27},"generated":{"line":3,"column":2736}},{"source":"index.js","name":"console","original":{"line":188,"column":12},"generated":{"line":3,"column":2741}},{"source":"index.js","name":"log","original":{"line":188,"column":20},"generated":{"line":3,"column":2749}},{"source":"index.js","original":{"line":188,"column":24},"generated":{"line":3,"column":2753}},{"source":"index.js","name":"catch","original":{"line":190,"column":11},"generated":{"line":3,"column":2782}},{"source":"index.js","original":{"line":190,"column":17},"generated":{"line":3,"column":2788}},{"source":"index.js","name":"err","original":{"line":190,"column":18},"generated":{"line":3,"column":2797}},{"source":"index.js","name":"console","original":{"line":191,"column":12},"generated":{"line":3,"column":2800}},{"source":"index.js","name":"log","original":{"line":191,"column":20},"generated":{"line":3,"column":2808}},{"source":"index.js","original":{"line":191,"column":24},"generated":{"line":3,"column":2812}},{"source":"index.js","name":"err","original":{"line":191,"column":60},"generated":{"line":3,"column":2847}},{"source":"index.js","name":"console","original":{"line":194,"column":8},"generated":{"line":3,"column":2854}},{"source":"index.js","name":"log","original":{"line":194,"column":16},"generated":{"line":3,"column":2862}},{"source":"index.js","original":{"line":194,"column":20},"generated":{"line":3,"column":2866}},{"source":"index.js","name":"res","original":{"line":195,"column":8},"generated":{"line":3,"column":2909}},{"source":"index.js","name":"sendStatus","original":{"line":195,"column":12},"generated":{"line":3,"column":2911}},{"source":"index.js","original":{"line":195,"column":23},"generated":{"line":3,"column":2922}},{"source":"index.js","name":"app","original":{"line":202,"column":0},"generated":{"line":3,"column":2933}},{"source":"index.js","name":"post","original":{"line":202,"column":4},"generated":{"line":3,"column":2935}},{"source":"index.js","original":{"line":202,"column":9},"generated":{"line":3,"column":2940}},{"source":"index.js","original":{"line":202,"column":22},"generated":{"line":3,"column":2952}},{"source":"index.js","name":"req","original":{"line":202,"column":23},"generated":{"line":3,"column":2961}},{"source":"index.js","name":"res","original":{"line":202,"column":28},"generated":{"line":3,"column":2963}},{"source":"index.js","name":"console","original":{"line":204,"column":2},"generated":{"line":3,"column":2966}},{"source":"index.js","name":"log","original":{"line":204,"column":10},"generated":{"line":3,"column":2974}},{"source":"index.js","name":"req","original":{"line":204,"column":14},"generated":{"line":3,"column":2978}},{"source":"index.js","name":"body","original":{"line":204,"column":18},"generated":{"line":3,"column":2980}},{"source":"index.js","name":"payload","original":{"line":205,"column":8},"generated":{"line":3,"column":2986}},{"source":"index.js","name":"payload","original":{"line":205,"column":8},"generated":{"line":3,"column":2990}},{"source":"index.js","name":"JSON","original":{"line":205,"column":18},"generated":{"line":3,"column":2992}},{"source":"index.js","name":"stringify","original":{"line":205,"column":23},"generated":{"line":3,"column":2997}},{"source":"index.js","original":{"line":205,"column":33},"generated":{"line":3,"column":3007}},{"source":"index.js","name":"title","original":{"line":205,"column":35},"generated":{"line":3,"column":3008}},{"source":"index.js","name":"req","original":{"line":205,"column":57},"generated":{"line":3,"column":3014}},{"source":"index.js","name":"req","original":{"line":205,"column":57},"generated":{"line":3,"column":3029}},{"source":"index.js","name":"req","original":{"line":205,"column":57},"generated":{"line":3,"column":3036}},{"source":"index.js","name":"body","original":{"line":205,"column":61},"generated":{"line":3,"column":3038}},{"source":"index.js","name":"header","original":{"line":205,"column":66},"generated":{"line":3,"column":3043}},{"source":"index.js","name":"body","original":{"line":205,"column":76},"generated":{"line":3,"column":3051}},{"source":"index.js","name":"req","original":{"line":205,"column":82},"generated":{"line":3,"column":3056}},{"source":"index.js","name":"body","original":{"line":205,"column":86},"generated":{"line":3,"column":3058}},{"source":"index.js","name":"value","original":{"line":205,"column":91},"generated":{"line":3,"column":3063}},{"source":"index.js","name":"options","original":{"line":206,"column":8},"generated":{"line":3,"column":3071}},{"source":"index.js","original":{"line":206,"column":18},"generated":{"line":3,"column":3073}},{"source":"index.js","name":"TTL","original":{"line":207,"column":4},"generated":{"line":3,"column":3074}},{"source":"index.js","name":"ttl","original":{"line":207,"column":9},"generated":{"line":3,"column":3078}},{"source":"index.js","name":"console","original":{"line":209,"column":2},"generated":{"line":3,"column":3081}},{"source":"index.js","name":"log","original":{"line":209,"column":10},"generated":{"line":3,"column":3089}},{"source":"index.js","name":"payload","original":{"line":209,"column":14},"generated":{"line":3,"column":3093}},{"source":"index.js","name":"chromePush","original":{"line":210,"column":8},"generated":{"line":3,"column":3096}},{"source":"index.js","name":"chromePush","original":{"line":210,"column":8},"generated":{"line":3,"column":3100}},{"source":"index.js","original":{"line":210,"column":21},"generated":{"line":3,"column":3102}},{"source":"index.js","name":"Promise","original":{"line":210,"column":25},"generated":{"line":3,"column":3106}},{"source":"index.js","original":{"line":210,"column":33},"generated":{"line":3,"column":3114}},{"source":"index.js","name":"resolve","original":{"line":210,"column":34},"generated":{"line":3,"column":3123}},{"source":"index.js","name":"reject","original":{"line":210,"column":43},"generated":{"line":3,"column":3125}},{"source":"index.js","name":"PushSub","original":{"line":211,"column":4},"generated":{"line":3,"column":3128}},{"source":"index.js","name":"find","original":{"line":211,"column":12},"generated":{"line":3,"column":3130}},{"source":"index.js","original":{"line":211,"column":17},"generated":{"line":3,"column":3135}},{"source":"index.js","original":{"line":211,"column":21},"generated":{"line":3,"column":3138}},{"source":"index.js","name":"err","original":{"line":211,"column":22},"generated":{"line":3,"column":3147}},{"source":"index.js","name":"data","original":{"line":211,"column":27},"generated":{"line":3,"column":3149}},{"source":"index.js","name":"err","original":{"line":212,"column":10},"generated":{"line":3,"column":3152}},{"source":"index.js","name":"reject","original":{"line":212,"column":15},"generated":{"line":3,"column":3155}},{"source":"index.js","name":"err","original":{"line":212,"column":22},"generated":{"line":3,"column":3157}},{"source":"index.js","name":"data","original":{"line":213,"column":6},"generated":{"line":3,"column":3160}},{"source":"index.js","name":"forEach","original":{"line":213,"column":11},"generated":{"line":3,"column":3162}},{"source":"index.js","original":{"line":213,"column":19},"generated":{"line":3,"column":3170}},{"source":"index.js","name":"element","original":{"line":213,"column":20},"generated":{"line":3,"column":3179}},{"source":"index.js","name":"console","original":{"line":214,"column":8},"generated":{"line":3,"column":3182}},{"source":"index.js","name":"log","original":{"line":214,"column":16},"generated":{"line":3,"column":3190}},{"source":"index.js","original":{"line":214,"column":20},"generated":{"line":3,"column":3194}},{"source":"index.js","name":"element","original":{"line":214,"column":30},"generated":{"line":3,"column":3203}},{"source":"index.js","name":"webpush","original":{"line":215,"column":8},"generated":{"line":3,"column":3206}},{"source":"index.js","name":"sendNotification","original":{"line":215,"column":16},"generated":{"line":3,"column":3208}},{"source":"index.js","name":"element","original":{"line":215,"column":33},"generated":{"line":3,"column":3225}},{"source":"index.js","name":"payload","original":{"line":215,"column":42},"generated":{"line":3,"column":3227}},{"source":"index.js","name":"options","original":{"line":215,"column":51},"generated":{"line":3,"column":3229}},{"source":"index.js","name":"resolve","original":{"line":218,"column":4},"generated":{"line":3,"column":3236}},{"source":"index.js","name":"slackAnnouncement","original":{"line":220,"column":8},"generated":{"line":3,"column":3242}},{"source":"index.js","original":{"line":220,"column":28},"generated":{"line":3,"column":3244}},{"source":"index.js","name":"Promise","original":{"line":220,"column":32},"generated":{"line":3,"column":3248}},{"source":"index.js","original":{"line":220,"column":40},"generated":{"line":3,"column":3256}},{"source":"index.js","name":"resolve","original":{"line":220,"column":41},"generated":{"line":3,"column":3265}},{"source":"index.js","name":"reject","original":{"line":220,"column":50},"generated":{"line":3,"column":3267}},{"source":"index.js","name":"needle","original":{"line":221,"column":4},"generated":{"line":3,"column":3270}},{"source":"index.js","name":"post","original":{"line":221,"column":11},"generated":{"line":3,"column":3272}},{"source":"index.js","original":{"line":221,"column":16},"generated":{"line":3,"column":3277}},{"source":"index.js","original":{"line":221,"column":91},"generated":{"line":3,"column":3351}},{"source":"index.js","name":"msg","original":{"line":221,"column":92},"generated":{"line":3,"column":3352}},{"source":"index.js","name":"req","original":{"line":221,"column":100},"generated":{"line":3,"column":3356}},{"source":"index.js","name":"req","original":{"line":221,"column":100},"generated":{"line":3,"column":3359}},{"source":"index.js","name":"req","original":{"line":221,"column":100},"generated":{"line":3,"column":3366}},{"source":"index.js","name":"body","original":{"line":221,"column":104},"generated":{"line":3,"column":3368}},{"source":"index.js","name":"header","original":{"line":221,"column":109},"generated":{"line":3,"column":3373}},{"source":"index.js","name":"req","original":{"line":221,"column":120},"generated":{"line":3,"column":3380}},{"source":"index.js","name":"req","original":{"line":221,"column":120},"generated":{"line":3,"column":3386}},{"source":"index.js","name":"req","original":{"line":221,"column":120},"generated":{"line":3,"column":3393}},{"source":"index.js","name":"body","original":{"line":221,"column":124},"generated":{"line":3,"column":3395}},{"source":"index.js","name":"value","original":{"line":221,"column":129},"generated":{"line":3,"column":3400}},{"source":"index.js","original":{"line":221,"column":139},"generated":{"line":3,"column":3408}},{"source":"index.js","name":"json","original":{"line":221,"column":140},"generated":{"line":3,"column":3409}},{"source":"index.js","original":{"line":221,"column":145},"generated":{"line":3,"column":3415}},{"source":"index.js","original":{"line":221,"column":152},"generated":{"line":3,"column":3418}},{"source":"index.js","name":"error","original":{"line":221,"column":161},"generated":{"line":3,"column":3427}},{"source":"index.js","name":"response","original":{"line":221,"column":168},"generated":{"line":3,"column":3429}},{"source":"index.js","name":"error","original":{"line":222,"column":13},"generated":{"line":3,"column":3432}},{"source":"index.js","original":{"line":222,"column":45},"generated":{"line":3,"column":3435}},{"source":"index.js","name":"response","original":{"line":222,"column":22},"generated":{"line":3,"column":3440}},{"source":"index.js","name":"statusCode","original":{"line":222,"column":31},"generated":{"line":3,"column":3442}},{"source":"index.js","name":"reject","original":{"line":225,"column":12},"generated":{"line":3,"column":3453}},{"source":"index.js","original":{"line":225,"column":19},"generated":{"line":3,"column":3455}},{"source":"index.js","name":"resolve","original":{"line":223,"column":12},"generated":{"line":3,"column":3503}},{"source":"index.js","name":"Promise","original":{"line":229,"column":2},"generated":{"line":3,"column":3511}},{"source":"index.js","name":"all","original":{"line":229,"column":10},"generated":{"line":3,"column":3519}},{"source":"index.js","original":{"line":229,"column":14},"generated":{"line":3,"column":3523}},{"source":"index.js","name":"chromePush","original":{"line":229,"column":15},"generated":{"line":3,"column":3524}},{"source":"index.js","name":"slackAnnouncement","original":{"line":229,"column":26},"generated":{"line":3,"column":3526}},{"source":"index.js","name":"then","original":{"line":230,"column":5},"generated":{"line":3,"column":3530}},{"source":"index.js","name":"console","original":{"line":231,"column":6},"generated":{"line":3,"column":3535}},{"source":"index.js","name":"log","original":{"line":231,"column":14},"generated":{"line":3,"column":3543}},{"source":"index.js","original":{"line":231,"column":18},"generated":{"line":3,"column":3547}},{"source":"index.js","name":"wss","original":{"line":232,"column":6},"generated":{"line":3,"column":3573}},{"source":"index.js","name":"clients","original":{"line":232,"column":10},"generated":{"line":3,"column":3575}},{"source":"index.js","name":"forEach","original":{"line":232,"column":18},"generated":{"line":3,"column":3583}},{"source":"index.js","original":{"line":232,"column":26},"generated":{"line":3,"column":3591}},{"source":"index.js","name":"client","original":{"line":232,"column":27},"generated":{"line":3,"column":3600}},{"source":"index.js","name":"client","original":{"line":233,"column":8},"generated":{"line":3,"column":3603}},{"source":"index.js","name":"send","original":{"line":233,"column":15},"generated":{"line":3,"column":3605}},{"source":"index.js","original":{"line":233,"column":20},"generated":{"line":3,"column":3610}},{"source":"index.js","name":"res","original":{"line":235,"column":6},"generated":{"line":3,"column":3622}},{"source":"index.js","name":"sendStatus","original":{"line":235,"column":10},"generated":{"line":3,"column":3624}},{"source":"index.js","original":{"line":235,"column":21},"generated":{"line":3,"column":3635}},{"source":"index.js","name":"catch","original":{"line":237,"column":5},"generated":{"line":3,"column":3641}},{"source":"index.js","original":{"line":237,"column":11},"generated":{"line":3,"column":3647}},{"source":"index.js","name":"error","original":{"line":237,"column":12},"generated":{"line":3,"column":3656}},{"source":"index.js","name":"console","original":{"line":238,"column":6},"generated":{"line":3,"column":3659}},{"source":"index.js","name":"log","original":{"line":238,"column":14},"generated":{"line":3,"column":3667}},{"source":"index.js","name":"error","original":{"line":238,"column":18},"generated":{"line":3,"column":3671}},{"source":"index.js","name":"stack","original":{"line":238,"column":24},"generated":{"line":3,"column":3673}},{"source":"index.js","name":"d","original":{"line":241,"column":8},"generated":{"line":3,"column":3682}},{"source":"index.js","name":"d","original":{"line":241,"column":8},"generated":{"line":3,"column":3686}},{"source":"index.js","original":{"line":241,"column":12},"generated":{"line":3,"column":3688}},{"source":"index.js","name":"Date","original":{"line":241,"column":16},"generated":{"line":3,"column":3692}},{"source":"index.js","original":{"line":242,"column":17},"generated":{"line":3,"column":3697}},{"source":"index.js","name":"Message","original":{"line":242,"column":21},"generated":{"line":3,"column":3701}},{"source":"index.js","original":{"line":242,"column":29},"generated":{"line":3,"column":3703}},{"source":"index.js","name":"header","original":{"line":242,"column":31},"generated":{"line":3,"column":3704}},{"source":"index.js","name":"req","original":{"line":242,"column":39},"generated":{"line":3,"column":3711}},{"source":"index.js","name":"body","original":{"line":242,"column":43},"generated":{"line":3,"column":3713}},{"source":"index.js","name":"header","original":{"line":242,"column":48},"generated":{"line":3,"column":3718}},{"source":"index.js","name":"msg","original":{"line":242,"column":56},"generated":{"line":3,"column":3725}},{"source":"index.js","name":"req","original":{"line":242,"column":61},"generated":{"line":3,"column":3729}},{"source":"index.js","name":"body","original":{"line":242,"column":65},"generated":{"line":3,"column":3731}},{"source":"index.js","name":"value","original":{"line":242,"column":70},"generated":{"line":3,"column":3736}},{"source":"index.js","name":"time","original":{"line":242,"column":77},"generated":{"line":3,"column":3742}},{"source":"index.js","name":"d","original":{"line":242,"column":83},"generated":{"line":3,"column":3747}},{"source":"index.js","name":"save","original":{"line":243,"column":9},"generated":{"line":3,"column":3751}},{"source":"index.js","name":"catch","original":{"line":244,"column":5},"generated":{"line":3,"column":3758}},{"source":"index.js","original":{"line":244,"column":11},"generated":{"line":3,"column":3764}},{"source":"index.js","name":"err","original":{"line":244,"column":12},"generated":{"line":3,"column":3773}},{"source":"index.js","name":"console","original":{"line":245,"column":6},"generated":{"line":3,"column":3776}},{"source":"index.js","name":"log","original":{"line":245,"column":14},"generated":{"line":3,"column":3784}},{"source":"index.js","original":{"line":245,"column":18},"generated":{"line":3,"column":3788}},{"source":"index.js","name":"err","original":{"line":245,"column":58},"generated":{"line":3,"column":3827}},{"source":"index.js","name":"fs","original":{"line":247,"column":2},"generated":{"line":3,"column":3832}},{"source":"index.js","name":"readFile","original":{"line":247,"column":5},"generated":{"line":3,"column":3834}},{"source":"index.js","original":{"line":247,"column":14},"generated":{"line":3,"column":3843}},{"source":"index.js","original":{"line":247,"column":33},"generated":{"line":3,"column":3861}},{"source":"index.js","original":{"line":247,"column":41},"generated":{"line":3,"column":3868}},{"source":"index.js","name":"err","original":{"line":247,"column":42},"generated":{"line":3,"column":3877}},{"source":"index.js","name":"data","original":{"line":247,"column":47},"generated":{"line":3,"column":3879}},{"source":"index.js","name":"err","original":{"line":248,"column":8},"generated":{"line":3,"column":3882}},{"source":"index.js","name":"err","original":{"line":248,"column":8},"generated":{"line":3,"column":3885}},{"source":"index.js","name":"console","original":{"line":249,"column":6},"generated":{"line":3,"column":3887}},{"source":"index.js","name":"log","original":{"line":249,"column":14},"generated":{"line":3,"column":3895}},{"source":"index.js","name":"err","original":{"line":249,"column":18},"generated":{"line":3,"column":3899}},{"source":"index.js","original":{"line":250,"column":11},"generated":{"line":3,"column":3906}},{"source":"index.js","name":"jsontable","original":{"line":251,"column":6},"generated":{"line":3,"column":3908}},{"source":"index.js","name":"JSON","original":{"line":251,"column":18},"generated":{"line":3,"column":3910}},{"source":"index.js","name":"parse","original":{"line":251,"column":23},"generated":{"line":3,"column":3915}},{"source":"index.js","name":"data","original":{"line":251,"column":29},"generated":{"line":3,"column":3921}},{"source":"index.js","name":"msgs","original":{"line":252,"column":16},"generated":{"line":3,"column":3925}},{"source":"index.js","name":"push","original":{"line":252,"column":21},"generated":{"line":3,"column":3930}},{"source":"index.js","original":{"line":252,"column":26},"generated":{"line":3,"column":3935}},{"source":"index.js","name":"heading","original":{"line":253,"column":8},"generated":{"line":3,"column":3936}},{"source":"index.js","name":"req","original":{"line":253,"column":17},"generated":{"line":3,"column":3944}},{"source":"index.js","name":"body","original":{"line":253,"column":21},"generated":{"line":3,"column":3946}},{"source":"index.js","name":"header","original":{"line":253,"column":26},"generated":{"line":3,"column":3951}},{"source":"index.js","name":"text","original":{"line":254,"column":8},"generated":{"line":3,"column":3958}},{"source":"index.js","name":"req","original":{"line":254,"column":14},"generated":{"line":3,"column":3963}},{"source":"index.js","name":"body","original":{"line":254,"column":18},"generated":{"line":3,"column":3965}},{"source":"index.js","name":"value","original":{"line":254,"column":23},"generated":{"line":3,"column":3970}},{"source":"index.js","name":"time","original":{"line":255,"column":8},"generated":{"line":3,"column":3976}},{"source":"index.js","name":"d","original":{"line":255,"column":14},"generated":{"line":3,"column":3981}},{"source":"index.js","name":"json","original":{"line":257,"column":12},"generated":{"line":3,"column":3985}},{"source":"index.js","name":"json","original":{"line":257,"column":12},"generated":{"line":3,"column":3989}},{"source":"index.js","name":"JSON","original":{"line":257,"column":19},"generated":{"line":3,"column":3991}},{"source":"index.js","name":"stringify","original":{"line":257,"column":24},"generated":{"line":3,"column":3996}},{"source":"index.js","name":"jsontable","original":{"line":257,"column":34},"generated":{"line":3,"column":4006}},{"source":"index.js","name":"fs","original":{"line":258,"column":6},"generated":{"line":3,"column":4009}},{"source":"index.js","name":"writeFile","original":{"line":258,"column":9},"generated":{"line":3,"column":4011}},{"source":"index.js","original":{"line":258,"column":19},"generated":{"line":3,"column":4021}},{"source":"index.js","name":"json","original":{"line":258,"column":38},"generated":{"line":3,"column":4039}},{"source":"index.js","original":{"line":258,"column":44},"generated":{"line":3,"column":4041}},{"source":"index.js","name":"app","original":{"line":263,"column":0},"generated":{"line":3,"column":4054}},{"source":"index.js","name":"post","original":{"line":263,"column":4},"generated":{"line":3,"column":4056}},{"source":"index.js","original":{"line":263,"column":9},"generated":{"line":3,"column":4061}},{"source":"index.js","original":{"line":263,"column":23},"generated":{"line":3,"column":4074}},{"source":"index.js","name":"req","original":{"line":263,"column":24},"generated":{"line":3,"column":4083}},{"source":"index.js","name":"res","original":{"line":263,"column":29},"generated":{"line":3,"column":4085}},{"source":"index.js","name":"promise","original":{"line":264,"column":8},"generated":{"line":3,"column":4088}},{"source":"index.js","name":"promise","original":{"line":264,"column":8},"generated":{"line":3,"column":4092}},{"source":"index.js","original":{"line":264,"column":18},"generated":{"line":3,"column":4094}},{"source":"index.js","name":"Promise","original":{"line":264,"column":22},"generated":{"line":3,"column":4098}},{"source":"index.js","original":{"line":264,"column":30},"generated":{"line":3,"column":4106}},{"source":"index.js","name":"resolve","original":{"line":264,"column":31},"generated":{"line":3,"column":4115}},{"source":"index.js","name":"reject","original":{"line":264,"column":40},"generated":{"line":3,"column":4117}},{"source":"index.js","name":"Message","original":{"line":265,"column":4},"generated":{"line":3,"column":4120}},{"source":"index.js","name":"findOne","original":{"line":265,"column":12},"generated":{"line":3,"column":4122}},{"source":"index.js","name":"sort","original":{"line":265,"column":22},"generated":{"line":3,"column":4132}},{"source":"index.js","original":{"line":265,"column":27},"generated":{"line":3,"column":4137}},{"source":"index.js","name":"field","original":{"line":265,"column":29},"generated":{"line":3,"column":4138}},{"source":"index.js","original":{"line":265,"column":36},"generated":{"line":3,"column":4144}},{"source":"index.js","name":"_id","original":{"line":265,"column":43},"generated":{"line":3,"column":4150}},{"source":"index.js","original":{"line":265,"column":49},"generated":{"line":3,"column":4155}},{"source":"index.js","name":"exec","original":{"line":265,"column":54},"generated":{"line":3,"column":4159}},{"source":"index.js","original":{"line":265,"column":59},"generated":{"line":3,"column":4164}},{"source":"index.js","name":"err","original":{"line":265,"column":60},"generated":{"line":3,"column":4173}},{"source":"index.js","name":"docs","original":{"line":265,"column":65},"generated":{"line":3,"column":4175}},{"source":"index.js","name":"mostrecent","original":{"line":266,"column":12},"generated":{"line":3,"column":4178}},{"source":"index.js","name":"mostrecent","original":{"line":266,"column":12},"generated":{"line":3,"column":4182}},{"source":"index.js","original":{"line":266,"column":25},"generated":{"line":3,"column":4184}},{"source":"index.js","name":"mostrecent","original":{"line":267,"column":6},"generated":{"line":3,"column":4187}},{"source":"index.js","name":"push","original":{"line":267,"column":17},"generated":{"line":3,"column":4189}},{"source":"index.js","name":"docs","original":{"line":267,"column":22},"generated":{"line":3,"column":4194}},{"source":"index.js","name":"err","original":{"line":268,"column":10},"generated":{"line":3,"column":4197}},{"source":"index.js","name":"reject","original":{"line":268,"column":15},"generated":{"line":3,"column":4200}},{"source":"index.js","name":"err","original":{"line":268,"column":22},"generated":{"line":3,"column":4202}},{"source":"index.js","name":"console","original":{"line":269,"column":6},"generated":{"line":3,"column":4205}},{"source":"index.js","name":"log","original":{"line":269,"column":14},"generated":{"line":3,"column":4213}},{"source":"index.js","original":{"line":269,"column":18},"generated":{"line":3,"column":4217}},{"source":"index.js","name":"wss","original":{"line":270,"column":6},"generated":{"line":3,"column":4241}},{"source":"index.js","name":"clients","original":{"line":270,"column":10},"generated":{"line":3,"column":4243}},{"source":"index.js","name":"forEach","original":{"line":270,"column":18},"generated":{"line":3,"column":4251}},{"source":"index.js","original":{"line":270,"column":26},"generated":{"line":3,"column":4259}},{"source":"index.js","name":"client","original":{"line":270,"column":27},"generated":{"line":3,"column":4268}},{"source":"index.js","name":"client","original":{"line":271,"column":12},"generated":{"line":3,"column":4271}},{"source":"index.js","name":"connect","original":{"line":271,"column":23},"generated":{"line":3,"column":4275}},{"source":"index.js","name":"client","original":{"line":272,"column":10},"generated":{"line":3,"column":4279}},{"source":"index.js","name":"send","original":{"line":272,"column":17},"generated":{"line":3,"column":4281}},{"source":"index.js","name":"JSON","original":{"line":272,"column":22},"generated":{"line":3,"column":4286}},{"source":"index.js","name":"stringify","original":{"line":272,"column":27},"generated":{"line":3,"column":4291}},{"source":"index.js","name":"mostrecent","original":{"line":272,"column":37},"generated":{"line":3,"column":4301}},{"source":"index.js","name":"console","original":{"line":273,"column":10},"generated":{"line":3,"column":4305}},{"source":"index.js","name":"log","original":{"line":273,"column":18},"generated":{"line":3,"column":4313}},{"source":"index.js","original":{"line":273,"column":22},"generated":{"line":3,"column":4317}},{"source":"index.js","name":"resolve","original":{"line":277,"column":4},"generated":{"line":3,"column":4345}},{"source":"index.js","name":"Promise","original":{"line":280,"column":2},"generated":{"line":3,"column":4351}},{"source":"index.js","name":"all","original":{"line":280,"column":10},"generated":{"line":3,"column":4359}},{"source":"index.js","original":{"line":280,"column":14},"generated":{"line":3,"column":4363}},{"source":"index.js","name":"promise","original":{"line":280,"column":15},"generated":{"line":3,"column":4364}},{"source":"index.js","name":"then","original":{"line":281,"column":5},"generated":{"line":3,"column":4368}},{"source":"index.js","name":"res","original":{"line":281,"column":10},"generated":{"line":3,"column":4373}},{"source":"index.js","name":"sendStatus","original":{"line":281,"column":14},"generated":{"line":3,"column":4375}},{"source":"index.js","original":{"line":281,"column":25},"generated":{"line":3,"column":4386}},{"source":"index.js","name":"catch","original":{"line":282,"column":5},"generated":{"line":3,"column":4392}},{"source":"index.js","original":{"line":282,"column":11},"generated":{"line":3,"column":4398}},{"source":"index.js","name":"error","original":{"line":282,"column":12},"generated":{"line":3,"column":4407}},{"source":"index.js","name":"console","original":{"line":283,"column":6},"generated":{"line":3,"column":4410}},{"source":"index.js","name":"log","original":{"line":283,"column":14},"generated":{"line":3,"column":4418}},{"source":"index.js","name":"error","original":{"line":283,"column":18},"generated":{"line":3,"column":4422}},{"source":"index.js","name":"module","original":{"line":287,"column":0},"generated":{"line":3,"column":4429}},{"source":"index.js","name":"exports","original":{"line":287,"column":7},"generated":{"line":3,"column":4436}},{"source":"index.js","name":"app","original":{"line":287,"column":17},"generated":{"line":3,"column":4444}}],"sources":{"index.js":"const express = require('express');\r\nconst helmet = require('helmet');\r\nconst mongoose = require('mongoose');\r\nconst parser = require('body-parser');\r\nconst cors = require('cors');\r\nconst twilio = require('twilio')(process.env.TWILIO_LIVE_SID, process.env.TWILIO_LIVE_AUTH);\r\nconst needle = require('needle');\r\nconst webpush = require('web-push');\r\nconst WebSocket = require('ws');\r\nconst fs = require('file-system');\r\nconst Push = require('./schemas/schemas').pushSchema;\r\nconst Hack = require('./schemas/schemas').hackerSchema;\r\nconst Msg = require('./schemas/schemas').msgSchema;\r\n\r\nconst uri = process.env.PROD_MONGODB;\r\nconst PORT = process.env.PORT || 5000;\r\nconst publicVapidKey = process.env.WEBPUSH_PUBLIC;\r\nconst privateVapidKey = process.env.WEBPUSH_PRIVATE;\r\nconst ttl = 600;\r\nconst app = express();\r\n\r\napp.use(parser.urlencoded({ extended: true }));\r\napp.use(parser.json());\r\n\r\napp.use(helmet());\r\napp.use(express.static(__dirname));\r\n\r\napp.use(cors());\r\n\r\nwebpush.setGCMAPIKey(process.env.GCM_KEY);\r\nwebpush.setVapidDetails(\r\n  'mailto:dev@vandyhacks.org',\r\n  publicVapidKey,\r\n  privateVapidKey,\r\n);\r\n\r\nmongoose.connect(uri, { useNewUrlParser: true });\r\nmongoose.Promise = global.Promise;\r\n\r\nconst db = mongoose.connection;\r\n\r\ndb.on('error', console.error.bind(console, 'connection error:'));\r\ndb.once('open', () => {\r\n  console.log('Database open');\r\n});\r\n\r\nconst phoneArr = [];\r\nlet jsontable = {\r\n  msgs: [],\r\n};\r\n\r\nconst Hacker = db.model('Hacker', Hack);\r\nconst PushSub = db.model('PushSubscription', Push);\r\nconst Message = db.model('Message', Msg);\r\n\r\nfunction dbquery(callback) {\r\n  Hacker.find({}, (err, data) => {\r\n    if (err) throw err;\r\n    data.forEach((element) => {\r\n      let num = element.phone;\r\n      num = num.replace(/-/g, '');\r\n      if (!phoneArr.includes(num)) {\r\n        phoneArr.push(num);\r\n      }\r\n    });\r\n  });\r\n  callback();\r\n}\r\n\r\nfunction wait() {\r\n  setTimeout(() => {\r\n    dbquery(wait);\r\n  }, 30000);\r\n}\r\n\r\ndbquery(wait);\r\n\r\nconst server = app.get('/', (req, res) => {\r\n  res.sendFile(`${__dirname}/dayof.html`);\r\n  console.log('Live notifications page loaded');\r\n})\r\n  .listen(PORT);\r\n\r\nfunction heartbeat() {\r\n  this.isAlive = true;\r\n}\r\n\r\nlet connect;\r\nlet loggedin = false;\r\n\r\nconst wss = new WebSocket.Server({ server });\r\nwss.on('connection', (ws) => {\r\n  console.log('Client connected');\r\n  const wscopy = ws;\r\n  connect = ws;\r\n  wscopy.isAlive = true;\r\n  wscopy.ping('pingdata');\r\n  wscopy.on('pong', heartbeat);\r\n  const keepAlive = setInterval(() => {\r\n    if (wscopy.readyState !== 1 || !wscopy.isAlive) {\r\n      clearInterval(keepAlive);\r\n      wscopy.terminate();\r\n    } else {\r\n      wscopy.ping('pingdata');\r\n    }\r\n  }, 5000);\r\n  ws.on('close', () => {\r\n    wscopy.isAlive = false;\r\n    console.log('Client disconnected');\r\n  });\r\n});\r\n\r\napp.get('/login', (req, res) => {\r\n  res.sendFile(`${__dirname}/auth.html`);\r\n  console.log('Login page loaded');\r\n});\r\n\r\napp.get('/admin', (req, res) => {\r\n  if (!loggedin) {\r\n    res.redirect('/login');\r\n  } else {\r\n    res.sendFile(`${__dirname}/admin.html`);\r\n    console.log('Admin page loaded');\r\n  }\r\n});\r\n\r\napp.post('/login', (req, res) => {\r\n  if (req.body.password === process.env.PASSWORD) {\r\n    loggedin = true;\r\n    res.redirect('/admin');\r\n    console.log('Logged in');\r\n  } else {\r\n    res.redirect('/login');\r\n  }\r\n});\r\n\r\nsetTimeout(() => {\r\n  if (loggedin) {\r\n    loggedin = false;\r\n  }\r\n}, 300000);\r\n\r\napp.post('/admin', (req, res) => {\r\n  const smsMsg = new Promise((resolve, reject) => { // eslint-disable-line no-unused-vars\r\n    phoneArr.map(number => twilio.messages.create({\r\n      to: number,\r\n      from: process.env.TWILIO_MASS_SMS_SID,\r\n      body: `VandyHacks: ${req.body.msg}`,\r\n    }));\r\n    resolve();\r\n  });\r\n  Promise.all([smsMsg])\r\n    .then(\r\n      console.log('Message sent'),\r\n      res.redirect('back'),\r\n    )\r\n    .catch((err) => {\r\n      console.log(err);\r\n      res.redirect('back');\r\n    });\r\n});\r\n\r\nfunction isValidSaveRequest(req, res) {\r\n  // Check for endpoint\r\n  if (!req.body || !req.body.endpoint) {\r\n    // Not valid subscription\r\n    res.status(400);\r\n    console.log('Subscription must have endpoint');\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction exists(subscription) {\r\n  return PushSub.countDocuments({ endpoint: subscription.endpoint, key: subscription.key });\r\n}\r\n\r\napp.post('/savesub', (req, res) => {\r\n  if (isValidSaveRequest(req, res)) {\r\n    const push = new PushSub(req.body);\r\n    exists(push).then((count) => {\r\n      if (count === 0) {\r\n        console.log('Saving subscription to database');\r\n        push.save()\r\n          .then(() => {\r\n            res.setHeader('Content-type', 'application/json');\r\n            res.sendStatus(201);\r\n            console.log('Push subscription saved');\r\n          })\r\n          .catch((err) => {\r\n            console.log('Unable to save push subscription', err);\r\n          });\r\n      } else {\r\n        console.log('Subscription already exists in database');\r\n        res.sendStatus(201);\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\n// Dayof route\r\napp.post('/sendpush', (req, res) => {\r\n  // Resource created successfully\r\n  console.log(req.body); // added\r\n  const payload = JSON.stringify({ title: `VandyHacks: ${req.body.header}`, body: req.body.value });\r\n  const options = {\r\n    TTL: ttl,\r\n  };\r\n  console.log(payload);\r\n  const chromePush = new Promise((resolve, reject) => {\r\n    PushSub.find({}, (err, data) => {\r\n      if (err) reject(err);\r\n      data.forEach((element) => {\r\n        console.log('Data: ', element);\r\n        webpush.sendNotification(element, payload, options);\r\n      });\r\n    });\r\n    resolve();\r\n  });\r\n  const slackAnnouncement = new Promise((resolve, reject) => {\r\n    needle.post('https://vandyhacks-slackbot.herokuapp.com/api/announcements/loudspeaker', {msg: `${req.body.header}: ${req.body.value}`}, {json:true}, function(error, response) {\r\n        if (!error && response.statusCode == 200) {\r\n            resolve();\r\n        } else {\r\n            reject(\"Did not manage to post announcement to slack\")\r\n        }\r\n      });\r\n})\r\n  Promise.all([chromePush,slackAnnouncement])\r\n    .then(\r\n      console.log('Push notification sent'),\r\n      wss.clients.forEach((client) => {\r\n        client.send('reload');\r\n      }),\r\n      res.sendStatus(201),\r\n    )\r\n    .catch((error) => {\r\n      console.log(error.stack);\r\n    });\r\n\r\n  const d = new Date();\r\n  const newMsg = new Message({ header: req.body.header, msg: req.body.value, time: d });\r\n  newMsg.save()\r\n    .catch((err) => {\r\n      console.log('Unable to save message to database: ', err);\r\n    });\r\n  fs.readFile('pastnotifs.json', 'utf8', (err, data) => {\r\n    if (err) {\r\n      console.log(err);\r\n    } else {\r\n      jsontable = JSON.parse(data);\r\n      jsontable.msgs.push({\r\n        heading: req.body.header,\r\n        text: req.body.value,\r\n        time: d,\r\n      });\r\n      const json = JSON.stringify(jsontable);\r\n      fs.writeFile('pastnotifs.json', json, 'utf8');\r\n    }\r\n  });\r\n});\r\n\r\napp.post('/updatemsg', (req, res) => {\r\n  const promise = new Promise((resolve, reject) => {\r\n    Message.findOne().sort({ field: 'asc', _id: -1 }).exec((err, docs) => {\r\n      const mostrecent = [];\r\n      mostrecent.push(docs);\r\n      if (err) reject(err);\r\n      console.log('Connecting to client');\r\n      wss.clients.forEach((client) => {\r\n        if (client === connect) {\r\n          client.send(JSON.stringify(mostrecent));\r\n          console.log('Data sent to client');\r\n        }\r\n      });\r\n    });\r\n    resolve();\r\n  });\r\n\r\n  Promise.all([promise])\r\n    .then(res.sendStatus(201))\r\n    .catch((error) => {\r\n      console.log(error);\r\n    });\r\n});\r\n\r\nmodule.exports = app;\r\n"},"lineCount":null}},"hash":"8f88f3c9516de1b154b4379908c8a189","cacheData":{"env":{}}}